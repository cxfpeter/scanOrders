!function(e,t){t.MenusActions=e.createActions(["addItem","reduceItem","activeBigImgModel","initScroll","switchClassify","realTimeSearch","synData"]),t.ShopCarModelActions=e.createActions(["openShopCarModel","closeShopCarModel","cleanShopCarMenus","addItem","submit","recoverData","saveData","reduceItem"]),t.SuitModelActions=e.createActions(["openSuitModel","closeSuitModel","addItem","reduceItem","switchPropertyItem","confirm","switchSinglePackageItem"]),t.PropertyModelActions=e.createActions(["openPropertyModel","targetPropsCombinationList","closePropsCombinationList","reducePropsCombinationNum","addPropsCombinationNum","closePropertyModel","switchPropertyItem","add","reduce","confirm"]),t.SearchModelActions=e.createActions(["openSearchModel","closeSearchModel","search","realTime","confirm"]),t.FloatSectionActions=e.createActions(["open","close"]),t.CouponActions=e.createActions(["open","close","init"]),t.InitActions=e.createActions(["open","init","closeCheckOrder","againtOrder","closeCoupon"]),t.BigImgModelActions=e.createActions(["open","close","confirm","switchImg","addItem","reduceItem"]),t.NavActions=e.createActions(["switchClassification","scrollSwitchClassification"]),t.WebSocketActions=e.createActions(["send","submit","openStatus","getWsStatus"]),t.MealCardActions=e.createActions(["closeWithdrawal","withdrawal","closeWithdrawalResult"])}(window.Reflux,window),function(e,t,a,i,s,r,n,o,l,c,d,u,m,p,h,f,g,S,v){function _(e){var t=[],a=[];return"17965"==w||"17964"==w||"17814"==w||"20004"==w||(a=[{id:"01",itemname:"销量排行",is_attach:"0",status:!0,display:!0}],t=[{data:e.sales,title:"销量排行",sort:"0",classifyId:"01"}]),e.items.map(function(e,i){var s={id:e.id,itemname:e.itemname,is_attach:e.is_attach,status:!1,display:!0};a.push(s),t.push({data:e.products,title:e.itemname,sort:t.length,classifyId:e.id})}),[a,t]}function y(e){var t;return $.ajax({url:"ajax_search_ware.action",data:{shop_id:w,tablecode:b,keyword:e},type:"get",dataType:"json",async:!1,contentType:"application/x-www-form-urlencoded;charset=UTF-8",success:function(e){t=e},error:function(e){d.close(),o.openAlert("获取数据出错啦>_<!!! 请稍后再试")}}),t}function I(){var e;return $.ajax({url:"ajax_gettop_ware.action",data:{shop_id:w,tablecode:b},type:"get",dataType:"json",async:!1,timeout:3e4,contentType:"application/x-www-form-urlencoded;charset=UTF-8",success:function(t){e=t},error:function(e){o.openAlert("获取数据出错啦>_<!!! 请稍后再试")}}),e}function N(e,t){for(var a=1,i=k.length;a<i;a++)if(e==k[a].classifyId)for(var s=0,r=k[a].data.length;s<r;s++)if(t==k[a].data[s].id)return[a,k[a].data[s],s];return[void 0]}function C(e){var t=e.data,a=e.num,i={sendDataFormat:t.id+"|"+t.price_type+"_"+a+"_"+t.originalTotalPrice+"_"+t.name+"_"+t.totalPrice+"_!"},s=[];return t.props.map(function(e,t){for(var a=0,r=0,n=e.values.length;r<n;r++){if(e.values[r].selectedState&&"0"==e.is_multiple){s.push(e.values[r].p_value),a=1,i.sendDataFormat=i.sendDataFormat+e.p_name_id+"="+e.values[r].p_value_id+"!";break}e.values[r].selectedState&&"1"==e.is_multiple&&0==a?(s.push(e.values[r].p_value),a=1,i.sendDataFormat=i.sendDataFormat+e.p_name_id+"="+e.values[r].p_value_id+"!"):e.values[r].selectedState&&"1"==e.is_multiple&&1==a&&(s.push(e.values[r].p_value),i.sendDataFormat=i.sendDataFormat+e.p_name_id+"="+e.values[r].p_value_id+"!")}}),[i,s]}function E(e){var t=(new Date).valueOf();$.ajax({url:"ajax_getFkBalance.action?t="+t,data:{uid:getUserId()},type:"get",dataType:"json",contentType:"application/x-www-form-urlencoded;charset=UTF-8",success:function(t){e(t)},error:function(e){}})}function D(e,t,a){var i=(new Date).valueOf();$.ajax({url:"ajax_drawCash.action?t="+i,data:{uid:e,amount:t},type:"post",dataType:"json",contentType:"application/x-www-form-urlencoded;charset=UTF-8",success:function(e){a(0==e.ret_code?{success:!0}:{success:!1})},error:function(e){a({success:!1})}})}function M(e){var t=(new Date).valueOf();$.ajax({url:"ajax_get_shop_coupon_list.action?t="+t,data:{shop_id:w,uid:T},type:"get",dataType:"json",contentType:"application/x-www-form-urlencoded;charset=UTF-8",success:function(t){e(t)},error:function(e){}})}!function(e){history.pushState(null,null,location.href),window.addEventListener("popstate",function(){history.pushState(null,null,location.href)})}(function(){});var w=("http://"+location.host,getShopId()),b=Boolean(getTableCode())?getTableCode():"",k=[],P=[],T=getUserId();v.NavStore=e.createStore({listenables:[NavActions],onScrollSwitchClassification:function(e){this.navData.forEach(function(t,a){a!=e?t.status=!1:t.status=!0}),0==e?recordAction.add("001","-1"):recordAction.add("001",this.navData[e].id),this.trigger(this.navData)},onSwitchClassification:function(e){this.navData.forEach(function(t,a){a!=e?t.status=!1:t.status=!0}),0==e?recordAction.add("001","-1"):recordAction.add("001",this.navData[e].id),v.MenuStore.onSwitchClassify(e),this.trigger(this.navData)},initData:function(e){this.navData=e,this.trigger(this.navData)},cleanAll:function(){this.navData.forEach(function(e,t){e.userSelectedClassifyNum=0}),this.trigger(this.navData)},onSynClassifyNum:function(e,t){if(0!=e){var a=this.navData;!a[e].userSelectedClassifyNum||a[e].userSelectedClassifyNum<=0?a[e].userSelectedClassifyNum=t:(a[e].userSelectedClassifyNum<0&&(a[e].userSelectedClassifyNum=0),a[e].userSelectedClassifyNum=Number(a[e].userSelectedClassifyNum)+Number(t)),this.trigger(this.navData)}},getInitialState:function(){return void 0==this.navData&&(this.navData={}),this.navData}}),v.FloatSectionStore=e.createStore({listenables:[n],onOpen:function(){void 0!=v.floatTime?(clearTimeout(v.floatTime),this.floatState=!0,document.getElementById("floating").style.opacity="1",this.trigger(this.floatState)):(this.floatState=!0,this.trigger(this.floatState))},onClose:function(){try{v.floatTime=setTimeout(this.close,250),document.getElementById("floating").style.opacity="0"}catch(e){}},close:function(){this.floatState=!1,v.floatTime=void 0,this.trigger(this.floatState)},getInitialState:function(){return this.floatState}}),v.MenuStore=e.createStore({listenables:[t],_recoverData:function(e){var t=e.selectedMenus.filter(function(e,t){if("default"!=e.type&&"menu"==e.type){this.onSynRanklist({operateType:"add",id:e.id,number:e.userSelectedNum});var a=this.onSynData({operateType:"add",item_id:e.item_id,id:e.id,number:e.userSelectedNum});if(a[1]!=-1)return e}else if("default"!=e.type&&"suit"==e.type){this.onSynRanklist({operateType:"add",id:e.id,number:e.userSelectedNum});var a=this.onSynData({operateType:"add",item_id:e.item_id,id:e.id,number:e.userSelectedNum});if(a[1]!=-1)return e}else if("default"!=e.type&&"property"==e.type){this.onSynRanklist({operateType:"add",id:e.id,number:e.userSelectedNum,menuFormat:e.sendDataFormat,menuType:e.type,data:e});var a=this.onSynData({operateType:"add",item_id:e.item_id,id:e.id,number:e.userSelectedNum,menuFormat:e.sendDataFormat,menuType:e.type,data:e});if(a[1]!=-1)return e}}.bind(this));void 0!=t[0]&&a.recoverData(t)},_update:function(){this.trigger(this.listData)},_setMenuArray:function(){if(0==P.length){data=document.getElementsByTagName("article");for(var e=0,t=data.length;e<t;e++)P.push(data[e].offsetTop)}},_propertyAddType:function(e,t){var a=t.split("!"),i=e.props.length;e.rawPrice=e.rawPrice?e.rawPrice:e.curr_price,a=a.slice(1,a.length-1);var s=function(t,a){for(var s=0;s<i;s++)if(e.props[s].p_name_id==t)for(var r=0;r<e.props[s].values.length;r++)e.props[s].values[r].p_value_id==a?e.props[s].values[r].selectedState=!0:e.props[s].values[r].selectedState=!1},r=function(t,a){for(var i="#"+t+"_"+a+"#",s=0,r=e.prop_prices.length;s<r;s++)if(e.prop_prices[s].keys==i){e.curr_price=((1e4*e.rawPrice+1e4*e.prop_prices[s].price)/1e4).toFixed(2);break}};a.map(function(e,t){var a=e.split("=");s(a[0],a[1]),r(a[0],a[1])}),this._update()},getClassifySort:function(){return this.list.sort},setClassifySort:function(e){this.list.sort=e},_syn:function(e,t,a){"add"==t?0!=this.list.sort?this.onSynRanklist({operateType:"add",id:e.id,number:a,price:e.curr_price,menuType:e.type,data:e}):this.onSynData({operateType:"add",item_id:e.item_id,id:e.id,number:a,price:e.curr_price,menuType:e.type,data:e}):0!=this.list.sort?this.onSynRanklist({operateType:"reduce",id:e.id,number:-1,price:e.curr_price,menuType:e.type,data:e}):this.onSynData({operateType:"reduce",item_id:e.item_id,id:e.id,number:-1,price:e.curr_price,menuType:e.type,data:e}),this._update()},onSwitchModel:function(e){"bigImg"==e&&setTimeout(function(){m.open(this.list,sessionStorage.currentBigImg)}.bind(this),300)},onActiveBigImgModel:function(e,t){this.list=this.listData.allData[t],this.list.sort=t,this.classifyId=t,m.open(this.listData.allData,e,t)},onRealTimeSearch:function(e){for(var t=[],a=1,i=k.length;a<i;a++)k[a].data.map(function(a,i){a.name.indexOf(e)==-1&&a.name!=e||t.push(a)});return JSON.stringify(t)},onSynData:function(e){for(var t=e.operateType,a=e.item_id,i=e.id,s=e.number,r=-1,n=-1,o=1,l=k.length;o<l;o++)if(a==k[o].classifyId){r=o;for(var c=0,d=k[o].data.length;c<d;c++)if(i==k[o].data[c].id)return n=c,"add"==t?k[o].data[c].userSelectedNum?k[o].data[c].userSelectedNum=parseInt(k[o].data[c].userSelectedNum)+parseInt(s):k[o].data[c].userSelectedNum=s:(k[o].data[c].userSelectedNum=Number(k[o].data[c].userSelectedNum)+Number(s),k[o].data[c].userSelectedNum<0&&(k[o].data[c].userSelectedNum=0)),v.NavStore.onSynClassifyNum(o,s),[r,n]}return[r,n]},onSynRanklist:function(e){for(var t=e.operateType,a=e.id,i=e.number,s=0,r=k[0].data.length;s<r;s++)if(a==k[0].data[s].id)return void("add"==t?k[0].data[s].userSelectedNum?k[0].data[s].userSelectedNum=parseInt(k[0].data[s].userSelectedNum)+parseInt(i):k[0].data[s].userSelectedNum=i:parseInt(k[0].data[s].userSelectedNum)-parseInt(i)>=0&&(k[0].data[s].userSelectedNum=parseInt(k[0].data[s].userSelectedNum)+parseInt(i)))},_multiplayerAdd:function(e){var t={name:e.name,id:e.id,item_id:e.item_id,menuType:"menu",dataFormat:e.id+"_1_"+e.price+"_"+e.name+"_"+e.curr_price+"_"};v.serverShopCarStore.addItem(t)},onAddItem:function(e,t,a,i,s,r){this.list=this.listData.allData[r];var t=t?t:"menu",i=i?i:1;if(0==e.suit_items.length&&0==e.props.length){if(v.WebSocketStore.onOpenStatus())return void(v.WebSocketStore.onGetWsStatus()&&this._multiplayerAdd(e));e.userSelectedNum?e.userSelectedNum=parseInt(e.userSelectedNum)+parseInt(i):e.userSelectedNum=i,v.NavStore.onSynClassifyNum(this.list.sort,i),v.ShopCarModelStore.operateShopCarData({data:e,operateType:"add",menuType:"menu"}),this._syn(e,"add",i)}else 0!=e.suit_items.length&&0==e.props.length?(e.classifyNum=this.list.sort,v.SuitModelStore.onOpenSuitModel(e,t)):0!=e.props.length&&(e.classifyNum=this.list.sort,v.PropertyModelStore.onOpenPropertyModel(e,"new",t));this.listData.needScroll=!1,this.trigger(this.listData),v.recordAction.add("002",e.id)},_multiplayerReduce:function(e){var t={name:e.name,id:e.id,item_id:e.item_id,menuType:"menu",dataFormat:e.id+"_1_"+e.price+"_"+e.name+"_"+e.curr_price+"_"};v.serverShopCarStore.reduceItem(t)},onReduceItem:function(e,t,a){if(this.list=this.listData.allData[a],0==e.props.length&&0==e.suit_items.length){if(v.WebSocketStore.onOpenStatus())return void(v.WebSocketStore.onGetWsStatus()&&this._multiplayerReduce(e));if(e.userSelectedNum<=0)return void(e.userSelectedNum=0);--e.userSelectedNum,v.NavStore.onSynClassifyNum(this.list.sort,-1),this._syn(e,"reduce"),v.ShopCarModelStore.operateShopCarData({data:e,operateType:"reduce",menuType:"menu"})}else if(e.userSelectedNum>1)v.ShopCarModelStore.onOpenShopCarModel();else if(1==e.userSelectedNum){if(v.WebSocketStore.onOpenStatus())return void(v.WebSocketStore.onGetWsStatus()&&v.ShopCarModelStore.multiplayerPropertyReduce(e));0==e.props.length&&0!=e.suit_items.length?v.ShopCarModelStore.operateShopCarData({data:e,operateType:"reduce",menuType:"suit"}):v.ShopCarModelStore.operateShopCarData({data:e,operateType:"reduce",menuType:"property"}),e.userSelectedNum=0,v.NavStore.onSynClassifyNum(this.list.sort,-1),this._syn(e,"reduce")}else e.userSelectedNum=0;this.listData.needScroll=!1,this.trigger(this.listData),v.recordAction.add("059",e.id)},onSwitchClassify:function(e){this.listData.nowIdx=e,this.listData.needScroll=!0;var t=(document.getElementById("menu-article"),document.getElementById("groupTitle"+e));t.classList.add("startGPU"),t.scrollIntoView(!0),this.trigger(this.listData)},initData:function(e,t){this.listData={allData:e.slice(t),nowIdx:0,needScroll:!0},this.list=this.listData.allData[this.listData.nowIdx];var a=getCookie("lastFailOrderId");if(a&&localStorage.prevShopData){var i=JSON.parse(localStorage.prevShopData);i.shopId==w&&i.tableNum==b&&i.orderId==a?this._recoverData(i):localStorage.removeItem("prevShopData")}else if(localStorage.shopCarData){var i=JSON.parse(localStorage.shopCarData);i.shopId==w&&i.tableNum==b?this._recoverData(i):localStorage.removeItem("shopCarData")}this.trigger(this.listData)},getInitialState:function(){return void 0==this.listData&&(this.listData={}),this.listData}}),v.ShopCarModelStore=e.createStore({listenables:[a],_traverseShopCarData:function(e,t){if(0==e.length)return-1;for(var a=-1,i=0,s=e.length;i<s;i++)if(e[i].id==t.id){if("menu"==e[i].type)return i;if("suit"==e[i].type&&(e[i].suitsIdCombinationStr==t.suitsIdCombinationStr||void 0==t.suitsIdCombinationStr))return i;if("property"==e[i].type&&(e[i].propsIdString==t.propsIdString||void 0==t.propsIdString))return i}return a},_addNewData:function(e,t,a){var i={id:e.id,name:e.name,currPrice:e.curr_price,selectedItemPrice:e.curr_price,item_id:e.item_id,price:e.price,type:t,price_type:e.price_type,is_discount:e.is_discount,userSelectedNum:a,originalPrice:e.originalPrice?e.originalPrice:e.price};return e.rawPrice&&(i.rawPrice=e.rawPrice),"menu"==t?i.sendDataFormat=e.id+"_"+a+"_"+e.price+"_"+e.name+"_"+e.curr_price+"_":"suit"==t?(i.sendDataFormat=e.sendDataFormat,i.suitsIdCombinationStr=e.suitsIdCombinationStr,i.suitBasePrice=e.suitBasePrice,i.suitItem=e.suitItem):"property"==t&&(i.sendDataFormat=e.sendDataFormat,i.propsIdString=e.propsIdString,i.propertyBasePrice=e.propertyBasePrice),i},_closeShopCarNav:function(){var e=document.getElementById("shopCar");e&&(e.classList.add("closeShopCar"),setTimeout(function(){e.classList.remove("closeShopCar"),this.shopCarData.shopCarNav=!1,this.trigger(this.shopCarData)}.bind(this),230))},_saveToLocal:function(){0==this.shopCarData.count&&this.shopCarData.count?localStorage.removeItem("shopCarData"):localStorage.shopCarData=JSON.stringify(this.shopCarData)},_refresh:function(e,t,a,i){var s=i?i:1;if("menu"==a)this.shopCarData.selectedMenus[t].userSelectedNum=parseInt(this.shopCarData.selectedMenus[t].userSelectedNum)+parseInt(s),this.shopCarData.selectedMenus[t].sendDataFormat=e.id+"_"+this.shopCarData.selectedMenus[t].userSelectedNum+"_"+e.price+"_"+e.name+"_"+e.curr_price+"_";else if("suit"==a||"property"==a){this.shopCarData.selectedMenus[t].userSelectedNum=Number(this.shopCarData.selectedMenus[t].userSelectedNum)+Number(s);var r=this.shopCarData.selectedMenus[t].sendDataFormat.split("_");r[1]=this.shopCarData.selectedMenus[t].userSelectedNum,this.shopCarData.selectedMenus[t].sendDataFormat=r.join("_")}this.shopCarData.count=parseInt(this.shopCarData.count)+parseInt(s),this.shopCarData.countPrice=[this.shopCarData.countPrice,(e.curr_price*s).formatPrice()].priceAddFormat(),this.shopCarData.shopCarNav=!0,this._saveToLocal()},_parseSuit:function(e,t){for(var a,i,s=e.split("_"),r=[],n=t.suit_items,o=(n.length,0),l=0,c=s.length;l<c;l++){var d=s[l];if("-1"==s[l].indexOf("|")){var u=d.split(":"),m=u[0],p=u[1],h=u[2],f=this._filterSuit(n,m,p),g=f[0],S=f[1];o=[o,n[g].suit_products[S].inc_price].priceAddFormat(),r.push({name:n[g].suit_products[S].product_name,num:h,suitItemId:p})}else{var v=d.split("|"),u=v[0].split(":"),m=u[0],p=u[1],h=u[2],_=v[1].split("!"),f=this._filterSuit(n,m,p),g=f[0],S=f[1],y=n[g].suit_products[S].props,I=n[g].suit_products[S].prop_prices,N=y.length,C=n[g].suit_products[S].product_name,E="(",o=[o,n[g].suit_products[S].inc_price].priceAddFormat();_.map(function(e,t){var a=e.split("="),i=a[0],s=a[1],r=0,n=this._propertyAddMode(I,"#"+i+"_"+s+"#");o=[o,n].priceAddFormat();e:for(;r<N;r++)if(i==y[r].p_name_id)for(i4=0,l4=y[r].values.length;i4<l4;i4++)if(s==y[r].values[i4].p_value_id){E=E+y[r].values[i4].p_value+"、";break e}},this),C=C+E.slice(0,-1)+")",r.push({name:C,num:h,suitItemId:p})}}return a=[t.curr_price,o].priceAddFormat(),i=[t.price,o].priceAddFormat(),[r,a,i]},multiplayerDataCompare:function(e){return 0==e.length?void this.clearShopCar():void e.forEach(function(e,t){for(var a=-1,i=this.shopCarData.selectedMenus,s=0,r=i.length;s<r;s++)if(e.id==i[s].id){if(0==e.type){a=s;break}if(1==e.type&&e.pptyStr==i[s].propsIdString){a=s;break}}a==-1&&0!=e.count?this._synMultiplayerData(e,e.count,-1):a!=-1&&e.count!=i[a].userSelectedNum&&this._synMultiplayerData(e,Number(e.count)-Number(i[a].userSelectedNum),a)},this)},_propertyAddMode:function(e,t){for(var a=0,i=e.length;a<i;a++)if(e[a].keys==t)return e[a].price},_createMultiplayerPropertyShopCardData:function(e,t,a,i,s){var r=t.dataFormat.split("|"),n=r[1].split("_");n[1]=s,r[1]=n.join("_");var o=r.join("|"),l={id:e.id,name:t.name,item_id:t.itemId,price:e.price,originalPrice:i,type:"property",price_type:e.price_type,is_discount:e.is_discount,sendDataFormat:o,propsIdString:t.pptyStr,userSelectedNum:s};return l.curr_price=a,l.selectedItemPrice=a,l.propertyBasePrice=e.curr_price,l},_creatMultiPlayerSuitShopCardData:function(e,t,a,i,s,r){var n=t.dataFormat.split("_");n[1]=r;var o=n.join("_"),l={name:e.name,userSelectedNum:r,curr_price:i,originalPrice:s,suitsIdCombinationStr:t.pptyStr,sendDataFormat:o,suitItem:a,id:e.id,item_id:e.item_id,price:i,price_type:e.price_type,is_discount:e.is_discount,suitBasePrice:e.curr_price};return l},_propertyCountPrice:function(e,t){var a,i=e.pptyStr.split("_"),s=0;return i.forEach(function(e,a){e:for(var i=0,r=t.props.length;i<r;i++)for(var n=0,o=t.props[i].values.length;n<o;n++)if(e==t.props[i].values[n].p_value_id){var l=this._propertyAddMode(t.prop_prices,"#"+t.props[i].p_name_id+"_"+t.props[i].values[n].p_value_id+"#");s=[s,l].priceAddFormat();break e}},this),a=[t.price,s].priceAddFormat(),s=[t.curr_price,s].priceAddFormat(),[s,a]},_synMultiplayerData:function(e,t,a){var i=N(e.itemId,e.id);if(void 0!=i[0]){var s=i[1],r=i[0];if(v.MenuStore.onSynRanklist({operateType:"add",id:e.id,number:t}),v.NavStore.onSynClassifyNum(r,t),s.userSelectedNum?s.userSelectedNum=Number(s.userSelectedNum)+Number(t):s.userSelectedNum=t,0==e.type)t>0?this.operateShopCarData({data:s,operateType:"add",menuType:"menu",rank:a,num:t}):this.operateShopCarData({data:s,operateType:"reduce",menuType:"menu",rank:a,num:Math.abs(t)});else if(1==e.type)if(a==-1){var n=this._propertyCountPrice(e,s),o=this._createMultiplayerPropertyShopCardData(s,e,n[0],n[1],t);this.operateShopCarData({data:o,operateType:"add",menuType:"property",rank:-1,num:t})}else t>0?this.operateShopCarData({data:s,operateType:"add",menuType:"property",rank:a,num:t}):this.operateShopCarData({data:s,operateType:"reduce",menuType:"property",rank:a,num:Math.abs(t)});else if(2==e.type)if(a==-1){if(Boolean(e.pptyStr))var l=this._parseSuit(e.pptyStr,s),o=this._creatMultiPlayerSuitShopCardData(s,e,l[0],l[1],l[2],t);else var l=[[],s.curr_price,s.price],o=this._creatMultiPlayerSuitShopCardData(s,e,l[0],l[1],l[2],t);this.operateShopCarData({data:o,operateType:"add",menuType:"suit",rank:-1,num:t})}else t>0?this.operateShopCarData({data:s,operateType:"add",menuType:"suit",rank:a,num:t}):this.operateShopCarData({data:s,operateType:"reduce",menuType:"suit",rank:a,num:Math.abs(t)});v.MenuStore._update(),v.BigImgModelStore.update(),this.trigger(this.shopCarData)}},_calcCountPriceAndNum:function(){var e=0,t=0,a=0;this.shopCarData.selectedMenus.length>1?this.shopCarData.selectedMenus.forEach(function(i,s){t=Number(t)+Number(i.userSelectedNum),e=[e,i.userSelectedNum*i.currPrice].priceAddFormat(),a=[a,i.userSelectedNum*i.originalPrice].priceAddFormat()}):1==this.shopCarData.selectedMenus.length&&(t=this.shopCarData.selectedMenus[0].userSelectedNum,e=(t*this.shopCarData.selectedMenus[0].currPrice).formatPrice(),a=(t*this.shopCarData.selectedMenus[0].originalPrice).formatPrice(),this.shopCarData.shopId=w),0!=t?(this.shopCarData.count=t,this.shopCarData.countPrice=e,this.shopCarData.originalPrice=a,this.shopCarData.shopCarNav=!0):(this.shopCarData.count=0,this.shopCarData.countPrice=0,this.shopCarData.originalPrice=0,this.shopCarData.shopCarNav=!1)},onRecoverData:function(e){this.shopCarData={shopCarStatus:!1,shopCarNav:!0,tableNum:b,shopId:w},this.shopCarData.selectedMenus=e,this._calcCountPriceAndNum(),this._saveToLocal(),this.trigger(this.shopCarData)},operateShopCarData:function(e){var t=e.data,a=e.operateType,i=e.menuType,s=Boolean(e.rank)||0==e.rank?e.rank:this._traverseShopCarData(this.shopCarData.selectedMenus,e.data),r=e.num?e.num:1;if("add"==a)if(s==-1){var n=this._addNewData(t,i,r);this.shopCarData.selectedMenus.push(n),this._calcCountPriceAndNum()}else this._refresh(t,s,i);else if("reduce"==a&&this.shopCarData.count)if(this.shopCarData.count=Number(this.shopCarData.count)-Number(r),this.shopCarData.countPrice=parseFloat(((1e4*this.shopCarData.countPrice-t.curr_price*r*1e4)/1e4).toFixed(2)),this.shopCarData.selectedMenus[s].userSelectedNum>r)if(this.shopCarData.selectedMenus[s].userSelectedNum=this.shopCarData.selectedMenus[s].userSelectedNum-r,"menu"==i)this.shopCarData.selectedMenus[s].sendDataFormat=t.id+"_"+this.shopCarData.selectedMenus[s].userSelectedNum+"_"+t.price+"_"+t.name+"_"+t.curr_price+"_";else{var o=this.shopCarData.selectedMenus[s].sendDataFormat.split("_");o[1]=this.shopCarData.selectedMenus[s].userSelectedNum,this.shopCarData.selectedMenus[s].sendDataFormat=o.join("_")}else this.shopCarData.selectedMenus[s].userSelectedNum=0,this.shopCarData.selectedMenus.splice(s,1);this.shopCarData.count<=0?(this.shopCarData.countPrice=0,this.shopCarData.count=0,this.shopCarData.selectedMenus=[],this.shopCarData.shopCarStatus=!1,v.FloatSectionStore.onClose(),this._closeShopCarNav()):this._calcCountPriceAndNum(),this._saveToLocal(),this.trigger(this.shopCarData)},onOpenShopCarModel:function(e){this.shopCarData.selectedMenus.length>0&&(v.recordAction.add("003"),v.FloatSectionStore.onOpen(),this.shopCarData.shopCarStatus=!0,this.trigger(this.shopCarData))},onCloseShopCarModel:function(){this.shopCarData.shopCarStatus&&(v.recordAction.add("004"),v.FloatSectionStore.onClose(),this.shopCarData.shopCarStatus=!1,this.trigger(this.shopCarData))},clearShopCar:function(){this.shopCarData.selectedMenus.map(function(e,t){v.MenuStore.onSynData({operateType:"reduce",item_id:e.item_id,id:e.id,number:-e.userSelectedNum}),v.MenuStore.onSynRanklist({operateType:"reduce",id:e.id,number:-e.userSelectedNum})}),this.shopCarData={shopCarStatus:!1,shopCarNav:!1,count:0,countPrice:0,tableNum:b,originalPrice:0,selectedMenus:[]},v.MenuStore._update(),v.NavStore.cleanAll(),v.recordAction.add("005"),this.trigger(this.shopCarData),localStorage.shopCarData&&localStorage.removeItem("shopCarData")},wsClearShopCar:function(){v.serverShopCarStore.clear(),this.clearShopCar()},onCleanShopCarMenus:function(){v.WebSocketStore.onOpenStatus()?v.WebSocketStore.onGetWsStatus()&&h.open("多人点餐模式，清空购物车，其他人购物车也会被清空！确定要清空购物车？",this.wsClearShopCar):this.clearShopCar()},multiplayerPropertyReduce:function(e){var t=this._traverseShopCarData(this.shopCarData.selectedMenus,e);this._multiPlayerOperate(this.shopCarData.selectedMenus[t],"reduce")},_multiPlayerOperate:function(e,t){var a={name:e.name,id:e.id,item_id:e.item_id,menuType:e.type};if("add"==t){if("menu"==e.type)a.dataFormat=e.id+"_"+(Number(e.userSelectedNum)+1)+"_"+e.price+"_"+e.name+"_"+e.currPrice+"_";else if("property"==e.type){var i=e.sendDataFormat.split("_");a.dataFormat=i.join("_"),a.propsId=e.propsIdString}v.serverShopCarStore.addItem(a)}else{if("menu"==e.type)a.dataFormat=e.id+"_"+(Number(e.userSelectedNum)-1)+"_"+e.price+"_"+e.name+"_"+e.currPrice+"_";else if("property"==e.type){var i=e.sendDataFormat.split("_");a.dataFormat=i.join("_"),a.propsId=e.propsIdString}v.serverShopCarStore.reduceItem(a)}},onAddItem:function(e){var t=this.shopCarData.selectedMenus[e];if(v.WebSocketStore.onOpenStatus())return void(v.WebSocketStore.onGetWsStatus()&&this._multiPlayerOperate(t,"add"));if("menu"==t.type)t.userSelectedNum=Number(t.userSelectedNum)+1,t.sendDataFormat=t.id+"_"+t.userSelectedNum+"_"+t.price+"_"+t.name+"_"+t.currPrice+"_";else{t.userSelectedNum=Number(t.userSelectedNum)+1;var a=t.sendDataFormat.split("_");a[1]=t.userSelectedNum,t.sendDataFormat=a.join("_")}v.MenuStore.onSynData({operateType:"add",item_id:this.shopCarData.selectedMenus[e].item_id,id:this.shopCarData.selectedMenus[e].id,number:1});v.MenuStore.onSynRanklist({operateType:"add",id:this.shopCarData.selectedMenus[e].id,number:1}),v.MenuStore._update(),this.shopCarData.count=this.shopCarData.count+1,this.shopCarData.countPrice=[this.shopCarData.countPrice,t.currPrice].priceAddFormat(),v.recordAction.add("006"),this._saveToLocal(),this.trigger(this.shopCarData)},onReduceItem:function(e){var t=this.shopCarData.selectedMenus[e];if(v.WebSocketStore.onOpenStatus())return void(v.WebSocketStore.onGetWsStatus()&&this._multiPlayerOperate(t,"reduce"));if(v.MenuStore.onSynData({operateType:"reduce",item_id:this.shopCarData.selectedMenus[e].item_id,id:this.shopCarData.selectedMenus[e].id,number:-1}),v.MenuStore.onSynRanklist({operateType:"reduce",id:this.shopCarData.selectedMenus[e].id,number:-1}),t.userSelectedNum>1)if(--t.userSelectedNum,"menu"==t.type)t.sendDataFormat=t.id+"_"+t.userSelectedNum+"_"+t.price+"_"+t.name+"_"+t.currPrice+"_";else{var a=t.sendDataFormat.split("_");a[1]=t.userSelectedNum,t.sendDataFormat=a.join("_")}else this.shopCarData.selectedMenus.splice(e,1);this.shopCarData.countPrice=parseFloat(((1e4*this.shopCarData.countPrice-1e4*t.currPrice)/1e4).toFixed(2)),--this.shopCarData.count,this.shopCarData.count<=0&&(this.shopCarData.countPrice=0,this.shopCarData.count=0,this.shopCarData.selectedMenus=[],this.shopCarData.shopCarStatus=!1,v.FloatSectionStore.onClose(),this._closeShopCarNav()),this._saveToLocal(),v.MenuStore._update(),v.recordAction.add("006"),this.trigger(this.shopCarData)},onSaveData:function(e){switch(this._saveToLocal(),e){case 0:handleShowWare();break;case 1:showhisOrder();break;case 2:showUserInfo()}},onSubmit:function(){if(window.isSameTableCodeAndShop(),sessionStorage.is_mem=1,d.open("提交订单中"),v.WebSocketStore.onOpenStatus()){if(!v.WebSocketStore.onSubmit())return;sessionStorage.ws=!0}var e="",t=getCookie("ddtech_usermobile")?getCookie("ddtech_usermobile"):void 0;this.shopCarData.selectedMenus.map(function(t,a){e=e+t.sendDataFormat+","}),this._saveToLocal(),d.close(),sessionStorage.removeItem("fromPage"),setConfirmPageEntryLabel("online"),t&&11==t.length||2==sessionStorage.needRegCode?window.location.href=targetlink("confirmDishes.html?shop_id="+w+"&tablecode="+b+"&userid="+T):window.location.href=targetlink("login.html?shop_id="+w+"&tablecode="+b+"&target=confirm&userid="+T)},getInitialState:function(){return this.shopCarData={shopCarStatus:!1,shopCarNav:!1,count:0,countPrice:0,tableNum:b,originalPrice:0,selectedMenus:[]},this.shopCarData}}),v.SuitModelStore=e.createStore({listenables:[i],_traverse:function(e){var t=e.type,a=e.data,i=!0;a.data.suit_items.forEach(function(e,s){"1"!=e.max_select_no&&(i=!1),e.suit_products.forEach(function(i,s){"add"==t&&(i.selectedNum&&(i.selectedNum=0),(1==e.suit_products.length&&1==e.is_required||"1"==i.default_checked)&&(i.selectedNum=1,a.data.totalPrice=[a.data.totalPrice,i.inc_price].priceAddFormat(),a.data.originalPrice=[a.data.originalPrice,i.inc_price].priceAddFormat()))},this)},a),i?a.single=!0:a.single=!1},suitItemsFormat:function(e){var t=[],a=e.id+"_1_"+e.originalPrice+"_"+e.name+"_"+e.totalPrice+"_suit_",i="";return e.suit_items.map(function(e,s){var r=!1;e.suit_products.map(function(s,n){var o={};if(s.selectedNum){r||(r=!0,a=a+e.name+":"+e.suit_id+"="),o.name=s.product_name,o.num=s.selectedNum,o.suitItemId=s.product_id;var l=[];if(0==s.props.length)t.push(o),a=a+this.suit_id+":"+s.product_id+":"+s.inc_price+":"+s.product_name+":"+s.selectedNum+"|";else{if(o.props=[],s.props.map(function(e,t){for(var a={p_name_id:e.p_name_id,name:"",p_value_id:""},t=0,i=e.values.length;t<i;t++)if(e.values[t].selectedState){o.props.push(e.values[t].p_value),a.name=e.values[t].p_value,a.p_value_id=e.values[t].p_value_id,l.push(a);break}},l),0!=l.length){a=a+this.suit_id+":"+s.product_id+":"+s.inc_price+":"+s.product_name;var c="(",d="";l.map(function(e,t){c=c+e.name+"，",d=d+e.p_name_id+"="+e.p_value_id+"!"}),c=c.slice(0,-1)+")",d=d.slice(0,-1),a=a+c+":"+s.selectedNum+":"+d+"|",o.name=o.name+c}else a=a+this.suit_id+":"+s.product_id+":"+s.inc_price+":"+s.product_name+":"+s.selectedNum+"|";t.push(o)}var u=[s.product_id].concat(l.map(function(e){return e.p_value_id}));i=i+u.join(":")+"_"}},e),a=a.slice(0,-1)+"#"}),a=a.slice(0,-1),i=i.slice(0,-1),[a,i,t]},onSwitchSinglePackageItem:function(e,t,a){if(a.selectedNum){a.selectedNum=0;this._propsItemAmount(a.props,a.prop_prices);this.suitModelData.data.totalPrice=parseFloat(((1e4*this.suitModelData.data.totalPrice-1e4*a.inc_price)/1e4).toFixed(2)),this.suitModelData.data.originalPrice=parseFloat(((1e4*this.suitModelData.data.originalPrice-1e4*a.inc_price)/1e4).toFixed(2))}else this.suitModelData.data.suit_items[t].suit_products.forEach(function(e,t){if(e.selectedNum){e.selectedNum=0;var a=this._propsItemAmount(e.props,e.prop_prices);this.suitModelData.data.totalPrice=[this.suitModelData.data.totalPrice,e.inc_price,a].priceReduceFormat(),this.suitModelData.data.originalPrice=[this.suitModelData.data.originalPrice,e.inc_price,a].priceReduceFormat()}},this),a.selectedNum=1,this.suitModelData.data.totalPrice=[this.suitModelData.data.totalPrice,a.inc_price].priceAddFormat(),this.suitModelData.data.originalPrice=[this.suitModelData.data.originalPrice,a.inc_price].priceAddFormat();this.trigger(this.suitModelData)},onOpenSuitModel:function(e,t){v.FloatSectionStore.onOpen(),this.suitModelData.data=e,this.suitModelData.data.totalPrice=parseFloat(this.suitModelData.data.curr_price),this.suitModelData.data.originalPrice=parseFloat(this.suitModelData.data.price),this.suitModelData.data.rawPrice=this.suitModelData.data.rawPrice?this.suitModelData.data.rawPrice:this.suitModelData.data.curr_price,this._traverse({data:this.suitModelData,type:"add"}),this.suitModelData.status=!0,this.suitModelData.from=t,this.trigger(this.suitModelData)},onCloseSuitModel:function(e){var t=e.type?e.type:"close";"close"==t&&(this.suitModelData.data.curr_price=this.suitModelData.data.rawPrice),v.FloatSectionStore.onClose(),this.suitModelData.data=null,this.suitModelData.status=!1,"menu"!=this.suitModelData.from&&v.MenuStore.onSwitchModel(this.suitModelData.from),this.trigger(this.suitModelData)},_countNum:function(e){var t=!0,a=0,i=this.suitModelData.data.suit_items[e].max_select_no;return this.suitModelData.data.suit_items[e].suit_products.map(function(e,t){e.selectedNum&&(a+=e.selectedNum)}),a>=i&&(t=!1),t},_propsAddPriceModel:function(e,t){for(var a=0,i=e.length;a<i;a++)if(e[a].keys==t)return e[a].price;return 0},_propsItemAmount:function(e,t){for(var a=0,i=0,s=e.length;i<s;i++)for(var r=e[i].p_name_id,n=0,o=e[i].values.length;n<o;n++)if(e[i].values[n].selectedState){var l=this._propsAddPriceModel(t,"#"+r+"_"+e[i].values[n].p_value_id+"#");a=[a,l].priceAddFormat(),e[i].values[n].selectedState=!1}return a},onAddItem:function(e,t,a){var i=this._countNum(t);i?(a.selectedNum?(++a.selectedNum,this.suitModelData.data.totalPrice=[this.suitModelData.data.totalPrice,a.inc_price].priceAddFormat(),this.suitModelData.data.originalPrice=[this.suitModelData.data.originalPrice,a.inc_price].priceAddFormat()):(this.suitModelData.data.totalPrice=[this.suitModelData.data.totalPrice,a.inc_price].priceAddFormat(),this.suitModelData.data.originalPrice=[this.suitModelData.data.originalPrice,a.inc_price].priceAddFormat(),a.selectedNum=1),
this.trigger(this.suitModelData)):o.openAlert(this.suitModelData.data.suit_items[t].name+" 最多选 "+this.suitModelData.data.suit_items[t].max_select_no+" 份")},onReduceItem:function(e,t,a){a.selectedNum>1?--a.selectedNum:1==this.suitModelData.data.suit_items[t].suit_products[e].selectedNum&&(this.suitModelData.data.suit_items[t].suit_products[e].selectedNum=0),this.suitModelData.data.totalPrice=parseFloat(((1e4*this.suitModelData.data.totalPrice-1e4*a.inc_price)/1e4).toFixed(2)),this.suitModelData.data.originalPrice=parseFloat(((1e4*this.suitModelData.data.originalPrice-1e4*a.inc_price)/1e4).toFixed(2)),this.trigger(this.suitModelData)},onSwitchPropertyItem:function(e,t,a,i){this.suitModelData.data.suit_items[e].suit_products[t].props[a].values.map(function(e,t){t!=i?e.selectedState=!1:e.selectedState=!0}),this.trigger(this.suitModelData)},_multiplayerOperate:function(e,t,a,i){v.serverShopCarStore.addItem({name:e.name,id:e.id,item_id:e.item_id,propsId:a,menuType:"suit",dataFormat:t,ppty:""});var s=document.getElementById("suitModel");s.style.right="-1000px",setTimeout(function(){s.style.right="0px",this.onCloseSuitModel({type:"confirm"})}.bind(this),300)},onConfirm:function(){for(var e=0,t=this.suitModelData.data.suit_items.length;e<t;e++){var a=0,i=this.suitModelData.data.suit_items[e].suit_products;if(i.map(function(e,t){e.selectedNum&&(a+=e.selectedNum)}),a<this.suitModelData.data.suit_items[e].min_select_no)return void o.openAlert(this.suitModelData.data.suit_items[e].name+" 最少选 "+this.suitModelData.data.suit_items[e].min_select_no+" 份")}var s=this.suitItemsFormat(this.suitModelData.data);if(v.WebSocketStore.onOpenStatus())v.WebSocketStore.onGetWsStatus()&&this._multiplayerOperate(this.suitModelData.data,s[0],s[1],s[2]);else{var r={name:this.suitModelData.data.name,userSelectedNum:1,curr_price:this.suitModelData.data.totalPrice,originalPrice:this.suitModelData.data.originalPrice,suitsIdCombinationStr:s[1],sendDataFormat:s[0],suitItem:s[2],id:this.suitModelData.data.id,item_id:this.suitModelData.data.item_id,price:this.suitModelData.data.totalPrice,price_type:this.suitModelData.data.price_type,is_discount:this.suitModelData.data.is_discount,suitBasePrice:this.suitModelData.data.curr_price};setTimeout(function(){n.style.right="0px",this.onCloseSuitModel({type:"confirm"})}.bind(this),300),0!=v.MenuStore.getClassifySort()?v.MenuStore.onSynRanklist({operateType:"add",id:this.suitModelData.data.id,number:1,price:this.suitModelData.data.curr_price,menuType:"suit"}):v.MenuStore.onSynData({operateType:"add",item_id:this.suitModelData.data.item_id,id:this.suitModelData.data.id,number:1,price:this.suitModelData.data.curr_price,menuType:"suit"}),v.ShopCarModelStore.operateShopCarData({data:r,operateType:"add",menuType:"suit",num:1}),v.NavStore.onSynClassifyNum(this.suitModelData.data.classifyNum,1),this.suitModelData.data.userSelectedNum?this.suitModelData.data.userSelectedNum=Number(this.suitModelData.data.userSelectedNum)+1:this.suitModelData.data.userSelectedNum=1;var n=document.getElementById("suitModel");n.style.right="-1000px",v.MenuStore._update()}},getInitialState:function(){return this.suitModelData={data:{},from:"menu",status:!1,single:!1}}}),v.PropertyModelStore=e.createStore({listenables:[s],_addPriceModel:function(e){for(var t=0,a=0,i=this.propertyInfo.data.prop_prices.length;a<i;a++)if(this.propertyInfo.data.prop_prices[a].keys==e)return t=this.propertyInfo.data.prop_prices[a].price},_multiplayerOperate:function(e,t,a){v.serverShopCarStore.addItem({name:a,id:e.id,item_id:e.item_id,propsId:e.propsIdString,menuType:"property",dataFormat:t})},_initPropertyMenu:function(){var e=0,t="";return this.propertyInfo.data.props.forEach(function(a,i){a.values.forEach(function(i,s){if(i.p_father_id=a.p_name_id,i.p_tag="#"+a.p_name_id+"_"+i.p_value_id+"#",0==s&&1==a.is_required){i.selectedState=!0,t+=i.p_value_id+"_";var r=this._addPriceModel(i.p_tag);e=[r,e].priceAddFormat()}else i.selectedState=!1},this)},this),t=0!=t.length?t.slice(0,-1):"",[e,t]},_traverseProps:function(){var e=0,t="",a=0,i=0;return this.propertyInfo.data.props.forEach(function(a,i){a.values.forEach(function(a,i){if(a.selectedState){var s=this._addPriceModel(a.p_tag);e=[e,s].priceAddFormat(),t+=a.p_value_id+"_"}},this)},this),a=[e,this.propertyInfo.data.price].priceAddFormat(),i=[e,this.propertyInfo.data.curr_price].priceAddFormat(),t=t.slice(0,-1),[i,t,a]},onOpenPropertyModel:function(e,t,a){n.open(),this.propertyInfo.data=e,this.propertyInfo.from=a,this.propertyInfo.status=!0;var i=this._initPropertyMenu();this.propertyInfo.data.totalPrice=[e.curr_price,i[0]].priceAddFormat(),this.propertyInfo.data.originalTotalPrice=[e.price,i[0]].priceAddFormat(),this.propertyInfo.data.propsIdString=i[1],this.trigger(this.propertyInfo)},onSwitchPropertyItem:function(e,t){for(var a=this.propertyInfo.data.props[e],i=0,s=a.values.length;i<s;i++)i!=t&&a.values[i].selectedState?a.values[i].selectedState=!1:i!=t||a.values[i].selectedState?i==t&&a.values[i].selectedState&&0==a.is_required&&(a.values[i].selectedState=!1):a.values[i].selectedState=!0;var r=this._traverseProps();this.propertyInfo.data.totalPrice=r[0],this.propertyInfo.data.propsIdString=r[1],this.propertyInfo.data.originalTotalPrice=r[2],this.trigger(this.propertyInfo)},onConfirm:function(){var e=C({data:this.propertyInfo.data,num:1}),t=this.propertyInfo.data.name+("0"!=e[1].length?"("+e[1].join("、")+")":"");if(v.WebSocketStore.onOpenStatus())v.WebSocketStore.onGetWsStatus()&&this._multiplayerOperate(this.propertyInfo.data,e[0].sendDataFormat,t);else{var a={name:t,userSelectedNum:1,curr_price:this.propertyInfo.data.totalPrice,propsIdString:this.propertyInfo.data.propsIdString,sendDataFormat:e[0].sendDataFormat,id:this.propertyInfo.data.id,item_id:this.propertyInfo.data.item_id,price:this.propertyInfo.data.totalPrice,price_type:this.propertyInfo.data.price_type,is_discount:this.propertyInfo.data.is_discount,propertyBasePrice:this.propertyInfo.data.curr_price,originalPrice:this.propertyInfo.data.originalTotalPrice};v.ShopCarModelStore.operateShopCarData({data:a,operateType:"add",menuType:"property",num:1});var i=v.MenuStore.getClassifySort();0!=i?(v.NavStore.onSynClassifyNum(i,1),v.MenuStore.onSynRanklist({operateType:"add",id:a.id,number:1,menuType:"property"})):v.MenuStore.onSynData({operateType:"add",item_id:a.item_id,id:a.id,number:1,menuType:"property"}),this.propertyInfo.data.userSelectedNum?this.propertyInfo.data.userSelectedNum=Number(this.propertyInfo.data.userSelectedNum)+1:this.propertyInfo.data.userSelectedNum=1,this.propertyInfo.data.propsIdString=void 0}this.onClosePropertyModel("confirm"),v.MenuStore._update()},onClosePropertyModel:function(e){v.FloatSectionStore.onClose(),"clean"==e&&v.MenuStore._update(),this.propertyInfo.status=!1,this.propertyInfo.data=null,"menu"!=this.propertyInfo.from&&v.MenuStore.onSwitchModel(this.propertyInfo.from),this.trigger(this.propertyInfo)},getInitialState:function(){return this.propertyInfo={data:{},from:"menu",status:!1}}}),v.SearchModelStore=e.createStore({listenables:[r],onOpenSearchModel:function(){0==this.searchModelData.data.length?(this.searchModelData.state=!0,this.searchModelData.data=I().products):this.searchModelData.state=!0,v.recordAction.add("010"),this.trigger(this.searchModelData)},onCloseSearchModel:function(){this.searchModelData.state=!1,this.searchModelData.searchResult=[],this.trigger(this.searchModelData)},onSearch:function(e){this.searchModelData.searchResult=y(e).products,this.trigger(this.searchModelData)},onRealTime:function(e){if(""!=e){var t=JSON.parse(v.MenuStore.onRealTimeSearch(e));0!=t.length&&(this.searchModelData.searchResult=t,this.trigger(this.searchModelData))}else this.searchModelData.searchResult=[],this.searchModelData.state=!0,this.trigger(this.searchModelData)},onConfirm:function(e,t){var a;a="hot"==e?this.searchModelData.data[t]:this.searchModelData.searchResult[t];var i=N(a.item_id,a.id),s=i[1];v.NavStore.onSwitchClassification(i[0]),"1"!=s.dinein_stop?setTimeout(function(){var e=document.getElementById(s.item_id).offsetTop;document.getElementById("nav-ul").scrollTop=e-50>0?e-50:0,document.querySelector("#groupTitle"+i[0]+' .forsearch[id="'+s.id+'"]').scrollIntoView(!0),v.MenuStore.listData.needScroll=!1,v.MenuStore.onAddItem(s,void 0,void 0,void 0,void 0,i[0])},300):setTimeout(function(){var e=document.getElementById(s.item_id).offsetTop;document.getElementById("nav-ul").scrollTop=e-50>0?e-50:0;var t=document.getElementById(s.id).offsetTop-40;document.getElementById("menu-article").scrollTop=t},300),this.onCloseSearchModel()},getInitialState:function(){return this.searchModelData={state:!1,data:[],searchResult:[]},this.searchModelData}}),v.MealCardStore=e.createStore({listenables:[g],onCloseWithdrawal:function(){this.mealCardObj.status=!1,this.trigger(this.mealCardObj)},withdrawalResult:function(e){var t=e.success;this.mealCardObj.resultStatus=!0,this.mealCardObj.withdrawResult.success=t,this.trigger(this.mealCardObj)},onWithdrawal:function(){D(this.mealCardObj.mealCard.uid,this.mealCardObj.mealCard.fk_balance,this.withdrawalResult)},initData:function(e){"0"==e.ret_code&&"0"!=e.fk_info.fk_balance&&(this.mealCardObj.mealCard=e.fk_info,this.mealCardObj.status=!0),this.trigger(this.mealCardObj)},getInitialState:function(){return this.mealCardObj={status:!1,resultStatus:!1,mealCard:{},withdrawResult:{success:!1}},E(this.initData),this.mealCardObj}}),v.CouponStore=e.createStore({listenables:[S],initData:function(e){0!=e.list.length&&(this.couponObj={status:!0,couponList:e.list.reverse()},this.trigger(this.couponObj))},onClose:function(){this.couponObj.status=!1,this.trigger(this.couponObj)},getInitialState:function(){return this.couponObj={status:!1,couponList:[],platformList:[]},M(this.initData),this.couponObj}}),v.InitStore=e.createStore({listenables:[u],onOpen:function(){this.init.imgState=!1,this.trigger(this.init)},onCloseCoupon:function(){this.init.couponStatus=!1,this.trigger(this.init)},onCloseCheckOrder:function(){this.init.checkOrderState=!1,this.trigger(this.init)},onAgaintOrder:function(){console.info(this.init.previousOrderObj);for(var e=this.init.previousOrderObj,t=0,a=e.length;t<a;t++)1!=e[t].is_suit?0==e[t].sku_id?this.restorePreviousOrderSingle(e[t]):this.restorePreviousOrderProperty(e[t]):this.restorePreviousOrderSuit(e[t]);v.MenuStore._update()},restorePreviousOrderSingle:function(e){var t=v.MenuStore.onSynData({operateType:"add",item_id:e.product_item_id,id:e.item_id,number:1}),a=t[0],i=t[1];a!=-1&&(v.MenuStore.onSynRanklist({operateType:"add",id:e.item_id,number:1}),v.ShopCarModelStore.operateShopCarData({data:k[a].data[i],operateType:"add",menuType:"menu",num:1}))},getPropertyPrice:function(e,t){for(var a=0,i=e.length;a<i;a++)if(e[a].keys==t)return e[a].price},restorePreviousOrderProperty:function(e){var t=v.MenuStore.onSynData({operateType:"add",item_id:e.product_item_id,id:e.item_id,number:1}),a=t[0],i=t[1];if(a!=-1){v.MenuStore.onSynRanklist({operateType:"add",id:e.item_id,number:1});for(var s=k[a].data[i],r=0,n=0,o=0,l="",c="",d="",u=0,m=e.item_sku.length;u<m;u++){var p=this.getPropertyPrice(s.prop_prices,"#"+e.item_sku[u].p_name_id+"_"+e.item_sku[u].p_value_id+"#");r=[r,p].priceAddFormat(),l+=e.item_sku[u].p_value_id+"_",d=d+e.item_sku[u].p_name_id+"="+e.item_sku[u].p_value_id+"!"}n=[r,s.price].priceAddFormat(),o=[r,s.curr_price].priceAddFormat(),c=s.id+"|"+s.price_type+"_1_"+n+"_"+s.name+"_"+o+"_!",l=l.slice(0,-1);var h={name:e.itemname,userSelectedNum:1,curr_price:o,propsIdString:l,sendDataFormat:c+d,id:e.item_id,item_id:e.product_item_id,price:o,price_type:s.price_type,is_discount:s.is_discount,propertyBasePrice:s.curr_price,originalPrice:n};v.ShopCarModelStore.operateShopCarData({data:h,operateType:"add",menuType:"property",num:1})}},restorePreviousOrderSuit:function(e){var t=v.MenuStore.onSynData({operateType:"add",item_id:e.product_item_id,id:e.item_id,number:1}),a=t[0],i=t[1];if(a!=-1){var s=k[a].data[i],r=0,n=0,o=0,l="",c="",d="",u=[],m=-1,p=[];e.reverse?p=e.suitOrderItems:(p=e.suitOrderItems.reverse(),e.reverse=!0),v.MenuStore.onSynRanklist({operateType:"add",id:e.item_id,number:1});for(var h=0,f=p.length;h<f;h++){m!=-1?m==p[h].suit_group_id?d+="|":(m=p[h].suit_group_id,d=d+"#"+p[h].suit_group_name+":"+p[h].suit_group_id+"="):(m=p[h].suit_group_id,d=p[h].suit_group_name+":"+p[h].suit_group_id+"=");var g={};g.name=p[h].sub_prod_name,g.num=p[h].quantity,g.suitItemId=p[h].sub_prod_id,l+=p[h].sub_prod_id,r=[r,p[h].inc_price].priceAddFormat();if(0==p[h].suitOrdersSkus.length)d=d+p[h].suit_group_id+":"+p[h].sub_prod_id+":"+p[h].inc_price+":"+p[h].sub_prod_name+":"+p[h].quantity,l+="_";else{g.props=[];var S="(",_="",y=[];p[h].reverse?y=p[h].suitOrdersSkus:(p[h].reverse=!0,y=p[h].suitOrdersSkus.reverse());for(var I=0,N=y.length;I<N;I++)S=S+y[I].p_value+",",_=_+y[I].p_name_id+"="+y[I].p_value_id+"!",g.props.push(y[I].p_value),l=l+":"+y[I].p_value_id;S=S.slice(0,-1)+")",_=_.slice(0,-1),g.name=g.name+S,d=d+p[h].suit_group_id+":"+p[h].sub_prod_id+":"+p[h].inc_price+":"+g.name+":"+p[h].quantity+":"+_,l+="_"}u.push(g)}l=l.slice(0,-1),n=[r,s.price].priceAddFormat(),o=[r,s.curr_price].priceAddFormat(),c=e.item_id+"_1_"+n+"_"+e.itemname+"_"+o+"_suit_";var C={name:e.itemname,userSelectedNum:1,curr_price:o,originalPrice:n,suitsIdCombinationStr:l,sendDataFormat:c+d,suitItem:u,id:e.item_id,item_id:e.product_item_id,price:o,price_type:s.price_type,is_discount:s.is_discount,suitBasePrice:s.curr_price};v.ShopCarModelStore.operateShopCarData({data:C,operateType:"add",menuType:"suit",num:1})}},previousOrderInit:function(e){"object"==typeof e.orderdetail&&0!=e.orderdetail.length&&(this.init.previousOrderObj=e.orderdetail,this.trigger(this.init))},getInitialState:function(){try{v.recordAction.add("047","000")}catch(e){}sessionStorage.removeItem("currentCoupon"),sessionStorage.removeItem("couponList");var t=window.shopData,a=getCookie("advert");a=!!a&&JSON.parse(JSON.parse(a)),sessionStorage.isEveryone=!1,sessionStorage.if_discounted=t.detail.if_discounted,sessionStorage.needRegCode=getCookie("needRegCode"),sessionStorage.show_product_pic=t.detail.show_product_pic;var i=isWeiXin(),s=isAliPay(),r=getCookie("pay_channel");if(i||s||d.open("亲，请使用微信或最新版支付宝扫码点餐！",!1),"2"==r&&i?d.open("本店不支持 微信支付！请使用，支付宝！",!1):"5"!=r||i||d.open("本店只支持 微信支付！",!1),1==getCookie("shop_closed")&&d.open("本店系统升级中，请联系服务员点单！",!1),this.init={},1==t.detail.is_everyone?(this.init.multiplayer=!0,v.wsMessageQueue=[],v.wsMessageElem=document.createElement("ul"),v.WebSocketStore.onStart(),localStorage.removeItem("shopCarData"),localStorage.removeItem("prevShopData"),sessionStorage.isEveryone=!0):this.init.multiplayer=!1,!a||void 0!=sessionStorage.advert&&JSON.parse(sessionStorage.advert)[0].shop_id==w)if(a&&sessionStorage.advert){var a=JSON.parse(sessionStorage.advert);this.init.adside=a[0].discount_name}else this.init.adside=!1;else 10401!=a.ret_code&&a.page&&0!=a.page.length?(this.init.adside=a.page[0].discount_name,this.init.imgState=!0,this.init.img=a.page[0].background_pic,sessionStorage.advert=JSON.stringify(a.page)):this.init.adside=!1;var n=_(t.detail);return k=n[1],delete t.detail,v.NavStore.initData(n[0]),v.MenuStore.initData(k,0),this.init}}),v.BigImgModelStore=e.createStore({listenables:[m],onOpen:function(e,t,a){n.open(),this.bigImgItemInfo.data=e,this.bigImgItemInfo.title=e[a].title,this.bigImgItemInfo.sort=this.calcSort(e,a,t),this.bigImgItemInfo.status=!0,this.bigImgItemInfo.currentItem=e[a].data[t],this.bigImgItemInfo.classifyId=a,sessionStorage.currentBigImg=t,this.trigger(this.bigImgItemInfo)},calcSort:function(e,t,a){for(var i=0,s=0;s<t;s++)i+=e[s].data.length;return i+=a},calcLocal:function(e,t){for(var a=0,i=0,s=0,r=e[0].data.length;r<t;)r+=e[++s].data.length;return a=s,i=e[s].data.length-1-(r-t),[a,i]},onClose:function(){setTimeout(function(){this.bigImgItemInfo.data={},this.bigImgItemInfo.status=!1,v.islider.destroy(),this.trigger(this.bigImgItemInfo)}.bind(this),200),document.getElementById("showBigModel").classList.add("closeShowBig-model")},onAddItem:function(e){0!=this.bigImgItemInfo.currentItem.props.length||0!=this.bigImgItemInfo.currentItem.suit_items.length?setTimeout(function(){v.MenuStore.onAddItem(this.bigImgItemInfo.currentItem,void 0,void 0,void 0,void 0,e)}.bind(this),240):(n.close(),v.MenuStore.onAddItem(this.bigImgItemInfo.currentItem,void 0,void 0,void 0,void 0,e)),this.onClose(),this.trigger(this.bigImgItemInfo)},onReduceItem:function(e){0!=this.bigImgItemInfo.currentItem.props.length||0!=this.bigImgItemInfo.currentItem.suit_items.length?(this.onClose(),setTimeout(function(){v.MenuStore.onReduceItem(this.bigImgItemInfo.currentItem,void 0,e)}.bind(this),240)):v.MenuStore.onReduceItem(this.bigImgItemInfo.currentItem,void 0,e),this.trigger(this.bigImgItemInfo)},onSwitchImg:function(e){var t=this.calcLocal(this.bigImgItemInfo.data,e);this.bigImgItemInfo.currentItem=this.bigImgItemInfo.data[t[0]].data[t[1]],this.bigImgItemInfo.title=this.bigImgItemInfo.data[t[0]].title,this.bigImgItemInfo.classifyId=t[0],v.MenuStore.setClassifySort(t[0]),this.trigger(this.bigImgItemInfo)},update:function(){this.bigImgItemInfo.status&&this.trigger(this.bigImgItemInfo)},getInitialState:function(){return this.bigImgItemInfo={data:{},status:!1,sort:0,currentItem:{}},this.bigImgItemInfo}}),v.serverShopCarStore=e.createStore({initData:function(e){setTimeout(function(){document.getElementById("shopCarIcon")&&document.getElementById("shopCarIcon").classList.add("ShopCarAnimation"),v.ShopCarModelStore.multiplayerDataCompare(e),v.wsMessageElem.dispatchEvent(v.wsMessageEvent),1!=v.wsMessageQueue.length&&0!=v.wsMessageQueue.length||v.wsMessageElem.removeEventListener("wsMessageDealed",this._dealQueue,!1)})},addItem:function(e){var t=e.name,a=e.id,i=e.item_id,s=e.num?e.num:1,r=e.propsId?e.propsId:"",n=e.menuType,o=e.dataFormat;"menu"==n?n=0:"property"==n&&(n=1),v.WebSocketStore.onSend(2,{name:t,id:a,itemId:i,count:s,pptyStr:r,type:n,dataFormat:o})},reduceItem:function(e){var t=e.name,a=e.id,i=e.item_id,s=e.num?e.num:-1,r=e.propsId?e.propsId:"",n=e.menuType,o=e.dataFormat;"menu"==n?n=0:"property"==n&&(n=1),v.WebSocketStore.onSend(4,{name:t,id:a,itemId:i,count:s,pptyStr:r,type:n,dataFormat:o})},clear:function(){v.WebSocketStore.onSend(12,{})},getInitialState:function(){return this.serverShopCar}}),v.WebSocketStore=e.createStore({listenables:[f],_send:function(){2!=this.ws.orderStatus&&this.ws.send(JSON.stringify(this.ws.wsBaseInfo))},_closeMsg:function(){var e=this;setTimeout(function(){e.ws.msg.shift(),e.trigger(e.ws)},5e3)},_initSynData:function(e){0!=v.wsMessageQueue.length?v.wsMessageQueue.push(e):(v.wsMessageEvent=new Event("wsMessageDealed"),v.wsMessageElem.addEventListener("wsMessageDealed",this._dealQueue,!1),v.serverShopCarStore.initData(e.products),v.wsMessageQueue.push(e)),this.trigger(this.ws)},_synData:function(e){switch(this.ws.orderStatus=e.status,e.opt_type){case 1:this._initSynData(e);break;case 2:this._initSynData(e);break;case 4:this._initSynData(e);break;case 8:d.close(),this._initSynData(e);break;case 10:v.ShopCarModelStore.onCloseShopCarModel(),v.ShopCarModelStore.clearShopCar(),d.close();break;case 12:v.ShopCarModelStore.onCloseShopCarModel(),v.ShopCarModelStore.clearShopCar(),d.close()}switch(e.status){case 3:v.ShopCarModelStore.clearShopCar(),o.openAlert("下单成功！")}if(""!=e.msg&&8!=e.opt_type){var t={msg:e.msg};this.ws.msg.push(t),this._closeMsg(),this.trigger(this.ws)}},_dealQueue:function(){setTimeout(function(){if(document.getElementById("shopCarIcon"))try{document.getElementById("shopCarIcon").classList.remove("ShopCarAnimation")}catch(e){}},3e3),v.wsMessageQueue.shift(),0!=v.wsMessageQueue.length&&v.serverShopCarStore.initData(v.wsMessageQueue[0].products)},_error:function(){this.onStart()},_onclose:function(){this.onStart()},onStart:function(){var e=getCookie("nickname")?getCookie("nickname"):"同桌成员！";this.ws=window.webSocket(),this.ws.onmessage=this.wsMessage,this.ws.onopen=this._send,this.ws.onerror=this._error,this.ws.onclose=this._onclose,this.ws.wsBaseInfo={userId:T,shopId:w,tableCode:b,cookieId:getCookie("uniqueId"),nickName:e,mobile:getCookie("ddtech_usermobile"),opt_type:1,commit_token:void 0},sessionStorage.ws&&(this.ws.wsBaseInfo.opt_type=8,sessionStorage.removeItem("ws")),this.ws.msg=[],this.trigger(this.ws)},onSend:function(e,t){this.ws.wsBaseInfo.opt_type=e,this.ws.wsBaseInfo.product=t,this._send()},onSubmit:function(){return 2!=this.ws.orderStatus?(this.ws.wsBaseInfo.opt_type=6,this._send(),sessionStorage.wsBaseInfo=JSON.stringify(this.ws.wsBaseInfo),!0):(d.close(),o.openAlert("同桌在提交订单！","好 的"),!1)},onOpenStatus:function(){return!!this.ws},onGetWsStatus:function(){return 2!=this.ws.orderStatus||(o.openAlert("同桌在提交订单！","好 的"),!1)},wsMessage:function(e){if("ping"==e.data)this.ws.send("ok");else{var t=JSON.parse(e.data);this.ws.wsBaseInfo.commit_token=t.commit_token,this._synData(t)}},getInitialState:function(){return this.ws}})}(window.Reflux,window.MenusActions,window.ShopCarModelActions,window.SuitModelActions,window.PropertyModelActions,window.SearchModelActions,window.FloatSectionActions,window.AlertActions,window.AlertStore,window.WaitStore,window.WaitActions,window.InitActions,window.BigImgModelActions,window.navActions,window.ConfirmActions,window.WebSocketActions,window.MealCardActions,window.CouponActions,window),function(e,t,a,i,s,r,n,o,l,c,d,u,m,p,h,f,g,S,v,_,y,I,N,C,E,D,M,w,b,k,P){e.initializeTouchEvents(!0);var T=e.createClass({displayName:"WebSocket",mixins:[t.connect(D,"ws")],render:function(){var t=[];if(this.state.ws){for(var a=this.state.ws.msg.length,i=a-3>0?a-3:0;i<a;i++)t.push(e.createElement("li",{className:"ws-li openAlert"},this.state.ws.msg[i].msg));return e.createElement("div",{className:"ws",id:"ws"},e.createElement("ul",{className:"ws-ul"},t))}return null}}),A=[],F=e.createClass({displayName:"SilderImg",componentDidMount:function(){document.getElementById("silderId").style.height=document.body.clientWidth;var e=Number(this.props.sort);0==A.length&&this.props.menuData.map(function(e,t){for(var a=0,i=e.data.length;a<i;a++){var s=e.data[a].big_pic;e.data[a].big_pic&&(s=s.split("."),s[s.length-1]=s[s.length-1].toLowerCase(),s=s.join(".")),A.push({content:s})}}),P.islider=new iSlider({type:"pic",data:A,dom:document.getElementById("silderId"),isLooping:!0,animateType:"default",isAutoPlay:!1,fixPage:!0,isOverspread:!0,initIndex:e,plugins:["button"]}),P.islider.on("slideChanged",function(e){I.switchImg(e+1)})},render:function(){var t={height:document.body.clientWidth+"px"};return e.createElement("div",{id:"silderId",style:t})}}),O=e.createClass({displayName:"BigImgModel",mixins:[t.connect(y,"bigImgItemInfo")],close:function(e){I.close(),p.close()},prevent:function(e){e.preventDefault(),e.stopPropagation()},addItem:function(e){e.preventDefault(),e.stopPropagation(),I.addItem(this.state.bigImgItemInfo.classifyId),I.close()},reduceItem:function(e){e.preventDefault(),e.stopPropagation(),I.reduceItem(this.state.bigImgItemInfo.classifyId)},render:function(){return this.state.bigImgItemInfo.status?e.createElement("section",{className:"showBig-model",id:"showBigModel",onClick:this.close.bind(this,"close"),ref:"showBigModel"},e.createElement("div",{className:"showBig-popup-div"},e.createElement("div",{className:"showBig-popup-heading"},e.createElement("span",null,this.state.bigImgItemInfo.title)),e.createElement("span",{className:"close-big-img",onClick:this.close.bind(this,"close")}),e.createElement(F,{menuData:this.state.bigImgItemInfo.data,sort:this.state.bigImgItemInfo.sort}),e.createElement("div",{className:"popup-dish-info",onClick:this.close.bind(this,"close")},1!=this.state.bigImgItemInfo.currentItem.dinein_stop?e.createElement("div",{className:"operate-div"},this.state.bigImgItemInfo.currentItem.userSelectedNum>0?e.createElement("div",{className:"padding-6",onClick:this.reduceItem},e.createElement("span",{className:"reduce-btn btn ilBk-middle"})):null,this.state.bigImgItemInfo.currentItem.userSelectedNum>0?e.createElement("div",null,e.createElement("span",{className:"select-num ilBk-middle"},this.state.bigImgItemInfo.currentItem.userSelectedNum)):null,e.createElement("div",{className:"padding-6",onClick:this.addItem},this.state.bigImgItemInfo.currentItem.userSelectedNum>0?e.createElement("span",{className:"add-btn btn ilBk-middle"}):e.createElement("span",{className:"add-car ilBk-middle"},"加入购物车"))):e.createElement("div",{className:"bigImg-dinein_stop"},"已售完"),e.createElement("div",{className:"footerItem-info"},e.createElement("div",{className:"dish-name"},this.state.bigImgItemInfo.currentItem.name),e.createElement("div",null,e.createElement("span",{className:"sale-price-bigImg ilBk-middle"},"￥",this.state.bigImgItemInfo.currentItem.curr_price)))),this.state.bigImgItemInfo.currentItem.memo?e.createElement("div",{className:"showBig-popup-footer",onClick:this.prevent.bind(this)},this.state.bigImgItemInfo.currentItem.memo):null)):null}}),B=e.createClass({displayName:"ShopCardSuitItem",render:function(){var t=[];return this.props.data.map(function(a,i){t.push(e.createElement("li",null,e.createElement("div",null,a.name),e.createElement("div",null,a.num)))}),e.createElement("ul",{className:"menu-ul suitItem"},t)}}),x=e.createClass({displayName:"ShopCarItems",reduce:function(e,t){t.stopPropagation(),t.preventDefault(),1==this.props.shopCarList.length&&1==this.props.shopCarList[0].countNum&&this.props.closeModel(),i.reduceItem(e)},add:function(e,t){t.stopPropagation(),t.preventDefault(),i.addItem(e)},render:function(){var t=[];return this.props.shopCarList.map(function(a,i){"menu"==a.type||"property"==a.type?t.push(e.createElement("li",null,e.createElement("div",{className:"operate-div"},e.createElement("div",{className:"padding-6",onClick:this.reduce.bind(this,i)},e.createElement("span",{className:"reduce-btn btn ilBk-middle"})),e.createElement("div",null,e.createElement("span",{className:"select-num ilBk-middle"},a.userSelectedNum)),e.createElement("div",{className:"padding-6",onClick:this.add.bind(this,i)},e.createElement("span",{className:"add-btn  btn ilBk-middle"}))),e.createElement("div",{className:"footerItem-name"},a.name))):t.push(e.createElement("li",null,e.createElement("div",{className:"width-full"},e.createElement("div",{className:"operate-div"},e.createElement("div",{className:"padding-6",onClick:this.reduce.bind(this,i)},e.createElement("span",{className:"reduce-btn btn ilBk-middle"})),e.createElement("div",null,e.createElement("span",{className:"select-num ilBk-middle"},a.userSelectedNum)),e.createElement("div",{className:"padding-6",onClick:this.add.bind(this,i)},e.createElement("span",{className:"add-btn  btn ilBk-middle"}))),e.createElement("div",{className:"footerItem-name"},e.createElement("div",null,a.name))),e.createElement("div",{className:"width-full suitItem-div"},e.createElement(B,{data:a.suitItem}))))},this),e.createElement("ul",{id:"shopCardItem"},t)}}),j=e.createClass({displayName:"ShopCarModel",mixins:[t.connect(l,"shopCarData")],close:function(){setTimeout(function(){i.closeShopCarModel()},280);var e=this.refs.shopCarModel.getDOMNode();e.classList.add("close-shopCarModel")},cleanShopCar:function(){setTimeout(function(){i.closeShopCarModel(),i.cleanShopCarMenus()},280);var e=this.refs.shopCarModel.getDOMNode();e.classList.add("close-shopCarModel")},confirm:function(){recordAction.add("007"),i.submit()},prevent:function(e){e.preventDefault(),e.stopPropagation()},render:function(){return this.state.shopCarData.shopCarStatus?e.createElement("section",{className:"shopCar-model",ref:"shopCarModel",onClick:this.close},e.createElement("div",{id:"shop-card-div",onClick:this.prevent.bind(this)},e.createElement("div",{className:"shop-card-header"},e.createElement("i",{className:"close-popup",onClick:this.close}),e.createElement("div",{className:"shop-card-name"},"购物车"),e.createElement("div",{className:"clean-shopCard-div",onTouchStart:this.cleanShopCar},e.createElement("i",null),e.createElement("span",null,"清空购物车"))),e.createElement(x,{shopCarList:this.state.shopCarData.selectedMenus,closeModel:this.close}),e.createElement("div",{className:"shop-card-footer"},e.createElement("div",{className:"popup-shop-card"},e.createElement("div",{className:"shop-car"},e.createElement("b",{id:"count-dishes"},this.state.shopCarData.count)),e.createElement("div",{className:"count-price-div shopCard-conut-price-div"},e.createElement("span",null,"总价：￥"),e.createElement("span",null,this.state.shopCarData.countPrice))),e.createElement("div",{className:"popup-btn-confirm",onClick:this.confirm},"确认下单")))):null}}),R=e.createClass({displayName:"HotMenus",confirm:function(e,t){setTimeout(function(){n.confirm(e,t)},300),document.getElementById("searchSection").style.opacity=0},render:function(){var t=[];return this.props.hotList.map(function(a,i){"1"!=a.dinein_stop?t.push(e.createElement("li",{onClick:this.confirm.bind(this,"hot",i),key:a.name},e.createElement("span",null,a.name))):t.push(e.createElement("li",{className:"hotMenu-dineinStop",key:a.name},e.createElement("span",null,a.name)))},this),e.createElement("ul",{className:"hot-dish-ul"},t)}}),W=e.createClass({displayName:"SearchResultUl",confirm:function(e,t,a){a.stopPropagation(),setTimeout(function(){n.confirm(e,t)},300),document.getElementById("searchSection").style.opacity=0},render:function(){var t=[];return this.props.searchResultData.map(function(a,i){t.push(e.createElement("li",{onClick:this.confirm.bind(this,"search",i),key:a.name},a.name))},this),e.createElement("ul",{className:"hot-dish-search-ul"},t)}}),L=e.createClass({displayName:"SearchModel",mixins:[t.connect(u,"searchModelData")],searchBtn:function(){var e=this.refs.searchWord.getDOMNode().value;""!=e&&void 0!=e&&n.search(e)},back:function(){setTimeout(function(){n.closeSearchModel(),e.style.left="0px"},300);var e=this.refs.searchSection.getDOMNode();e.style.left="-1000px"},change:function(e){n.realTime(e.target.value)},render:function(){return this.state.searchModelData.state?e.createElement("section",{className:"search-model",ref:"searchSection",id:"searchSection"},e.createElement("div",{className:"header-search",key:"seatchSection"},e.createElement("div",{className:"close-search",onClick:this.back,key:"back"}),e.createElement("div",{key:"inputDiv"},e.createElement("span",{className:"search-ipt"},e.createElement("input",{type:"text",ref:"searchWord",onChange:this.change})),e.createElement("span",{className:"search-certain",onClick:this.searchBtn},"搜 索"))),0==this.state.searchModelData.searchResult.length?e.createElement("div",{className:"hot-dish-div",key:"hot"},e.createElement("div",{className:"hot-dish-header",key:"hot-dish"},e.createElement("div",{className:"hot-dish-title"},e.createElement("i",null),e.createElement("span",null,"本店热门"))),e.createElement(R,{hotList:this.state.searchModelData.data})):null,0!=this.state.searchModelData.searchResult.length?e.createElement(W,{searchResultData:this.state.searchModelData.searchResult}):null):null}}),q=e.createClass({displayName:"PropertyItem",switchItem:function(e,t){r.switchPropertyItem(e,t)},render:function(){var t=[];return this.props.items.map(function(a,i){a.selectedState?t.push(e.createElement("li",{className:"selected-property-item",onClick:this.switchItem.bind(this,this.props.fatherSort,i)},a.p_value)):t.push(e.createElement("li",{className:"property-item",onClick:this.switchItem.bind(this,this.props.fatherSort,i)},a.p_value))},this),e.createElement("ul",null,t)}}),U=e.createClass({displayName:"Property",render:function(){var t=[];return this.props.itemData.props.map(function(a,i){t.push(e.createElement("li",null,e.createElement("div",null,a.p_name),e.createElement(q,{items:a.values,fatherSort:i})))},this),e.createElement("div",{className:"popup-body"},e.createElement("ul",{className:"property-ul"},t))}}),G=e.createClass({displayName:"PropertyModel",mixins:[t.connect(d,"propertyData")],close:function(e){e.preventDefault(),e.stopPropagation(),setTimeout(function(){r.closePropertyModel("clean"),
t.style.right="0px"},300);var t=this.refs.propertyModel.getDOMNode();t.style.right="-1000px"},closePopup:function(e){e.preventDefault(),e.stopPropagation(),r.closePropsCombinationList()},confirm:function(e){e.preventDefault(),e.stopPropagation();for(var t=!1,a=0,i=this.state.propertyData.data.props.length;a<i;a++)if(t=!1,0==this.state.propertyData.data.props[a].is_required?t=!0:this.state.propertyData.data.props[a].values.map(function(e,a){e.selectedState&&(t=!0)}),!t)return void h.openAlert(this.state.propertyData.data.props[a].p_name+"您还没选择！");if(t){setTimeout(function(){r.confirm(),s.style.right="0px"},300);var s=this.refs.propertyModel.getDOMNode();s.style.right="-1000px"}},targetPropsCombination:function(e){e.preventDefault(),e.stopPropagation(),r.targetPropsCombinationList()},render:function(){return this.state.propertyData.status?e.createElement("section",{className:"property-model",ref:"propertyModel"},e.createElement("div",{className:"close-model",onClick:this.close},e.createElement("i",{className:"close-model-btn"})),e.createElement("div",{className:"popup-div"},e.createElement("div",{className:"popup-header"},e.createElement("div",null,e.createElement("img",{src:this.state.propertyData.data.small_pic,alt:""})),e.createElement("div",null,e.createElement("div",{className:"footerItem-name"},this.state.propertyData.data.name),e.createElement("div",null,e.createElement("span",{className:"sale-num ilBk-middle"},this.state.propertyData.data.sales),e.createElement("div",{className:"sale-price-suit"},"￥",this.state.propertyData.data.totalPrice)))),e.createElement(U,{itemData:this.state.propertyData.data}),e.createElement("div",{className:"popup-footer",onClick:this.confirm},"选好了"))):null}}),J=e.createClass({displayName:"SuitPropertyItem",switchItem:function(e,t,a,i,r){r.stopPropagation(),r.preventDefault(),s.switchPropertyItem(e,t,a,i)},render:function(){var t=[];return this.props.items.map(function(a,i){a.selectedState?t.push(e.createElement("li",{className:"selected-property-item",onClick:this.switchItem.bind(this,this.props.granpFather,this.props.grandfather,this.props.fatherSort,i)},a.p_value)):t.push(e.createElement("li",{className:"property-item",onClick:this.switchItem.bind(this,this.props.granpFather,this.props.grandfather,this.props.fatherSort,i)},a.p_value))},this),e.createElement("ul",null,t)}}),Q=e.createClass({displayName:"SuitItemProperty",prevent:function(e){e.preventDefault(),e.stopPropagation()},render:function(){var t=[];return this.props.propsList.map(function(a,i){t.push(e.createElement("li",null,e.createElement("div",null,a.p_name),e.createElement(J,{items:a.values,fatherSort:i,grandfather:this.props.grandfather,granpFather:this.props.granpFather})))},this),e.createElement("ul",{className:"property-ul mg-t10",onClick:this.prevent.bind(this)},t)}}),z=e.createClass({displayName:"SuitProducts",reduceItem:function(e,t,a,i){i.stopPropagation(),s.reduceItem(t,a,e)},addItem:function(e,t,a,i){i.stopPropagation(),s.addItem(t,a,e)},render:function(){var t=[];return this.props.suitProducts.map(function(a,i){t.push(e.createElement("li",{className:"popup-footItem-li"},e.createElement("div",{className:"operate-div"},a.selectedNum?e.createElement("div",{className:"padding-2"},e.createElement("span",{className:"reduce-btn btn ilBk-middle",onTouchStart:this.reduceItem.bind(this,a,i,this.props.fatherSort)})):null,a.selectedNum?e.createElement("div",null,e.createElement("span",{className:"select-num ilBk-middle"},a.selectedNum)):null,e.createElement("div",{className:"padding-2"},e.createElement("span",{className:"add-btn btn ilBk-middle",onTouchStart:this.addItem.bind(this,a,i,this.props.fatherSort)}))),e.createElement("div",{className:"foodItem-info"},e.createElement("span",{className:"foodItem-name"},a.product_name,a.inc_price>0?e.createElement("span",{className:"prompt-span"}):null)),0!=a.props.length&&a.selectedNum?e.createElement(Q,{propsList:a.props,grandfather:i,granpFather:this.props.fatherSort}):null))},this),e.createElement("ul",{className:"menu-ul bg-white"},t)}}),$=e.createClass({displayName:"SuitArticle",render:function(){var t=[];return this.props.suitDetailData.map(function(a,i){t.push(e.createElement("article",null,e.createElement("span",null,a.name,"（",a.suit_products.length,"选",a.max_select_no,"）",0==a.is_required?"非必选":"必选"),e.createElement(z,{suitProducts:a.suit_products,fatherSort:i})))},this),e.createElement("div",{className:"popup-body"},t)}}),H=e.createClass({displayName:"SinglePackageItems",switchItem:function(e,t,a,i){i.stopPropagation(),s.switchSinglePackageItem(t,a,e)},render:function(){var t=[];return this.props.suitProducts.map(function(a,i){t.push(e.createElement("li",{className:"popup-footItem-li singlePackage-li",onClick:this.switchItem.bind(this,a,i,this.props.fatherSort)},e.createElement("div",{className:"operate-div singlePackage-operate"},a.selectedNum?e.createElement("div",{className:"ico_xuanze_square_down"}):e.createElement("div",{className:"ico_xuanze_square_up"})),e.createElement("div",{className:"foodItem-info"},e.createElement("span",{className:"foodItem-name"},a.product_name)),0!=a.props.length&&a.selectedNum?e.createElement(Q,{propsList:a.props,grandfather:i,granpFather:this.props.fatherSort}):null))},this),e.createElement("ul",{className:"menu-ul bg-white"},t)}}),V=e.createClass({displayName:"SinglePackage",render:function(){var t=[];return this.props.suitDetailData.map(function(a,i){t.push(e.createElement("article",null,e.createElement("span",null,a.name,"（",a.suit_products.length,"选",a.max_select_no,"）",0==a.is_required?"非必选":"必选"),e.createElement(H,{suitProducts:a.suit_products,fatherSort:i})))},this),e.createElement("div",{className:"popup-body"},t)}}),X=e.createClass({displayName:"SuitModel",mixins:[t.connect(c,"suitModelData")],close:function(e){e.preventDefault(),e.stopPropagation(),setTimeout(function(){s.closeSuitModel({type:"close"}),t.style.right="0px"},300);var t=this.refs.suitModel.getDOMNode();t.style.right="-1000px"},confirm:function(e){e.preventDefault(),e.stopPropagation(),s.confirm()},render:function(){return this.state.suitModelData.status?e.createElement("section",{className:"suit-model",ref:"suitModel",id:"suitModel"},e.createElement("div",{className:"close-model",onTouchStart:this.close},e.createElement("i",{className:"close-model-btn"})),e.createElement("div",{className:"popup-div"},e.createElement("div",{className:"popup-header"},e.createElement("div",null,e.createElement("img",{src:this.state.suitModelData.data.small_pic,alt:""})),e.createElement("div",null,e.createElement("div",{className:"footerItem-name"},this.state.suitModelData.data.name),e.createElement("div",{className:"sale-num-suit"},this.state.suitModelData.data.sales,"份",e.createElement("span",{className:"sale-price-suit"},"￥",this.state.suitModelData.data.totalPrice)))),this.state.suitModelData.single?e.createElement(V,{suitDetailData:this.state.suitModelData.data.suit_items}):e.createElement($,{suitDetailData:this.state.suitModelData.data.suit_items}),e.createElement("div",{className:"popup-footer",onTouchStart:this.confirm},"选好了"))):null}}),Y=e.createClass({displayName:"FloatSection",mixins:[t.connect(m,"floatState")],render:function(){return this.state.floatState?e.createElement("section",{className:"floating-div",id:"floating"}):null}}),K=e.createClass({displayName:"FooterNav",handleShowWare:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){i.saveData(),handleShowWare()}),showhisOrder:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){i.saveData(),showhisOrder()}),showUserInfo:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){i.saveData(),showUserInfo()}),jump:function(e){i.saveData(e)},render:function(){return e.createElement("footer",{className:"footer-nav"},e.createElement("div",{className:"footer-nav-div"},e.createElement("ul",{className:"now-online-ul footer-nav-ul"},e.createElement("li",{className:"online-icon"}),e.createElement("li",{className:"text-li"},"点餐"))),e.createElement("div",{className:"footer-nav-div",onClick:this.jump.bind(this,1)},e.createElement("ul",{className:"footer-nav-ul history-ul"},e.createElement("li",{className:"history-icon"}),e.createElement("li",{className:"text-li"},"历史订餐"))),e.createElement("div",{className:"footer-nav-div",onClick:this.jump.bind(this,2)},e.createElement("ul",{className:"personal-ul footer-nav-ul"},e.createElement("li",{className:"personal-icon"}),e.createElement("li",{className:"text-li"},"个人中心"))))}}),Z=e.createClass({displayName:"FooterCar",mixins:[t.connect(l,"shopCarData")],confirm:function(){recordAction.add("008"),i.submit()},render:function(){if(this.state.shopCarData.shopCarNav)try{var t=document.getElementById("shopCarIcon"),a=document.getElementById("ws");a&&(a.style.bottom="8rem"),setTimeout(function(){t&&(t.style.backgroundImage="url(./imgs/gouwuche_down.png)")},1500)}catch(i){}else{var a=document.getElementById("ws");a&&(a.style.bottom="3.8rem")}return this.state.shopCarData.shopCarNav?e.createElement("footer",{className:"footer-car",id:"shopCar"},e.createElement("div",{className:"shop-car-div"},e.createElement("div",{className:"shop-car",id:"shopCarIcon",onTouchStart:l.onOpenShopCarModel}),e.createElement("div",{className:"peopleNum"},"共",e.createElement("span",{id:"selectedCount"},this.state.shopCarData.count),"份"),e.createElement("div",{className:"count-price-div"},e.createElement("span",null,"总价：￥"),e.createElement("span",null,this.state.shopCarData.countPrice))),e.createElement("div",{className:"certain-div"},e.createElement("div",{className:"certain-btn",onClick:this.confirm},"下一步"))):null}}),ee=e.createClass({displayName:"MenuItem",_parabola:function(e,t){var a=document.createElement("i");a.classList.add("ball","startGPU"),a.style.left=e+-20+"px",a.style.top=t+-20+"px",document.body.appendChild(a);var i=document.getElementById("shopCarIcon"),s=funParabola(a,i,{speed:"100",curvature:"0.008",complete:function(){document.body.removeChild(a),i.style.backgroundImage="url(./imgs/gouwuche_down.png)"}}).mark();a.style.marginLeft="0px",a.style.marginTop="0px",s.init()},addItem:function(e,t,i){i.stopPropagation(),i.preventDefault();i.clientX,i.clientY;e.userSelectedNum<=0&&(e.userSelectedNum=0),a.addItem(e,t,void 0,void 0,void 0,this.props.classifyId),0==e.suit_items.length&&0==e.props.length&&D.onOpenStatus()&&!D.onGetWsStatus()},reduceItem:function(e,t,i){return i.stopPropagation(),i.preventDefault(),e.userSelectedNum<=0?void(e.userSelectedNum=0):void a.reduceItem(e,t,this.props.classifyId)},showBig:function(e,t,i){0==i&&""==e.small_pic||a.activeBigImgModel(t,this.props.classifyId)},render:function(){var t=[],a=0,i=[],s=this.props.menuData;if(1==sessionStorage.show_product_pic){for(var r=0,n=this.props.menuData.length;r<n;r++){var o=this.props.menuData[r];"1"!=o.dinein_stop?(o.flags&&0!=o.flags.length&&o.flags.map(function(e,t){"新品"==e.name&&(o.xinPing=1)}),2==o.pic_show_patt||0==o.pic_show_patt||r==s.length-1&&8!=o.pic_show_patt&&4!=o.pic_show_patt||!o.pic_show_patt?t.push(e.createElement("li",{className:"smallImg-footItem forsearch",id:o.id,key:o.id,onClick:this.showBig.bind(this,o,r,0)},e.createElement("div",null,0!=o.small_pic.length?e.createElement("img",{src:o.small_pic,alt:"菜品图片"}):e.createElement("img",{src:"./imgs/defaultImg.png",alt:"默认图片"})),e.createElement("div",{className:"info"},e.createElement("div",{className:"footItem-name"},e.createElement("span",null,o.name,1==o.has_discount?e.createElement("i",{className:"item-icon tejia-icon"}):null,1==o.showcase?e.createElement("i",{className:"item-icon zhaopai-icon"}):null,1==o.hotlevel?e.createElement("i",{className:"item-icon la-icon"}):null,o.xinPing?e.createElement("i",{className:"item-icon xinping-icon"}):null)),e.createElement("div",{className:"footerItem-info-operate"},e.createElement("div",{className:"operate-div"},o.userSelectedNum>0?e.createElement("div",{onClick:this.reduceItem.bind(this,o,r),className:" reduce-btn-div"},e.createElement("span",{className:"reduce-btn btn ilBk-middle"})):null,o.userSelectedNum>0?e.createElement("div",null,e.createElement("span",{className:"select-num ilBk-middle"},o.userSelectedNum)):null,e.createElement("div",{className:"add-btn-div",onClick:this.addItem.bind(this,o,r)},e.createElement("span",{className:"add-btn btn ilBk-middle"}))),e.createElement("div",{className:"footerItem-info"},e.createElement("div",null,e.createElement("span",{className:"sale-num-small ilBk-middle"},o.sales)),e.createElement("div",null,e.createElement("span",{className:"sale-price ilBk-middle"},"￥",o.curr_price),parseFloat(o.curr_price)<parseFloat(o.price)?e.createElement("span",{className:"original-price"},o.price):null)))))):4==o.pic_show_patt?(++a,r+1<s.length&&4!=s[r+1].pic_show_patt&&a%2!=0&&(s[r+1].pic_show_patt=4),t.push(e.createElement("li",{className:"mediumImg-footItem footItem-mode forsearch",id:o.id,key:o.id,onClick:this.showBig.bind(this,o,r)},null,null,e.createElement("span",{className:"menuIcon-div menuIcon-sale"},"已售",o.sales,"份"),1==o.has_discount?e.createElement("span",{className:"menuIcon-div menuIcon-tejia"},"特价美食"):null,1==o.showcase?e.createElement("span",{className:"menuIcon-div menuIcon-zhaopai"},"招牌美食"):null,0!=o.big_pic.length?e.createElement("div",null,1==o.hotlevel?e.createElement("div",{className:"hot-dish-ico middle-model"}):null,e.createElement("img",{src:o.big_pic,alt:"菜品图片"})):e.createElement("img",{src:"./imgs/defaultImg.png",alt:"默认图片"}),e.createElement("div",{className:"info"},e.createElement("div",{className:"foodItem-info"},e.createElement("span",{className:"foodItem-name"},o.name),e.createElement("span",{className:"sale-price ilBk-middle"},"￥",o.curr_price),parseFloat(o.curr_price)<parseFloat(o.price)?e.createElement("span",{className:"original-price"},o.price):null,null),e.createElement("div",{className:"operate-div"},o.userSelectedNum>0?e.createElement("div",{onClick:this.reduceItem.bind(this,o,r),className:"reduce-btn-div"},e.createElement("span",{className:"reduce-btn btn ilBk-middle"})):null,o.userSelectedNum>0?e.createElement("div",null,e.createElement("span",{className:"select-num ilBk-middle"},o.userSelectedNum)):null,e.createElement("div",{onClick:this.addItem.bind(this,o,r),className:"add-btn-div"},e.createElement("span",{className:"add-btn btn ilBk-middle"}))))))):8==o.pic_show_patt&&t.push(e.createElement("li",{className:"bigImg-footItem footItem-mode forsearch",id:o.id,key:o.id,onClick:this.showBig.bind(this,o,r,2)},null,null,e.createElement("span",{className:"menuIcon-div menuIcon-sale"},"已售",o.sales,"份"),1==o.has_discount?e.createElement("span",{className:"menuIcon-div menuIcon-tejia"},"特价美食"):null,1==o.showcase?e.createElement("span",{className:"menuIcon-div menuIcon-zhaopai"},"招牌美食"):null,0!=o.b_src_pic_url.length?e.createElement("div",null,1==o.hotlevel?e.createElement("div",{className:"hot-dish-ico big_pic-model"}):null,e.createElement("img",{src:o.b_src_pic_url,alt:"菜品图片"})):e.createElement("img",{src:"./imgs/defaultImg.png",alt:"默认图片"}),e.createElement("div",{className:"info"},e.createElement("div",{className:"operate-div"},o.userSelectedNum>0?e.createElement("div",{onClick:this.reduceItem.bind(this,o,r),className:"reduce-btn-div"},e.createElement("span",{className:"reduce-btn btn ilBk-middle"})):null,o.userSelectedNum>0?e.createElement("div",null,e.createElement("span",{className:"select-num ilBk-middle"},o.userSelectedNum)):null,e.createElement("div",{onClick:this.addItem.bind(this,o,r),className:"add-btn-div"},e.createElement("span",{className:"add-btn btn ilBk-middle"}))),e.createElement("div",{className:"foodItem-info"},e.createElement("span",{className:"foodItem-name"},o.name),e.createElement("span",{className:"sale-price ilBk-middle"},"￥",o.curr_price),parseFloat(o.curr_price)<parseFloat(o.price)?e.createElement("span",{className:"original-price"},o.price):null,null))))):i.push(o)}if(0!=i.length)for(var r=0,n=i.length;r<n;r++){var o=i[r];t.push(e.createElement("li",{className:"smallImg-footItem forsearch",id:o.id,key:o.id,onClick:this.showBig.bind(this,o,r,0)},e.createElement("div",null,0!=o.small_pic.length?e.createElement("img",{src:o.small_pic,alt:"菜品图片"}):e.createElement("img",{src:"./imgs/defaultImg.png",alt:"默认图片"})),e.createElement("div",{className:"info"},e.createElement("div",{className:"footItem-name"},e.createElement("span",null,o.name,1==o.has_discount?e.createElement("i",{className:"item-icon tejia-icon"}):null,1==o.showcase?e.createElement("i",{className:"item-icon zhaopai-icon"}):null,1==o.hotlevel?e.createElement("i",{className:"item-icon la-icon"}):null,o.xinPing?e.createElement("i",{className:"item-icon xinping-icon"}):null)),e.createElement("div",{className:"footerItem-info-operate"},e.createElement("div",{className:"operate-div"}),e.createElement("div",{className:"footerItem-info"},e.createElement("div",null,e.createElement("span",{className:"sale-num-small ilBk-middle"},o.sales)),e.createElement("div",null,e.createElement("span",{className:"sale-price ilBk-middle"},"￥",o.curr_price),parseFloat(o.curr_price)<parseFloat(o.price)?e.createElement("span",{className:"original-price"},o.price):null)))),e.createElement("div",{className:"outOfStock"})))}}else{for(var r=0,n=this.props.menuData.length;r<n;r++){var o=this.props.menuData[r];"1"!=o.dinein_stop?t.push(e.createElement("li",{className:"smallImg-footItem forsearch",id:o.id,key:o.id},e.createElement("div",null),e.createElement("div",{className:"info"},e.createElement("div",{className:"no-picture-footItem-name"},e.createElement("span",null,o.name,1==o.has_discount?e.createElement("i",{className:"item-icon tejia-icon"}):null,1==o.showcase?e.createElement("i",{className:"item-icon zhaopai-icon"}):null,1==o.hotlevel?e.createElement("i",{className:"item-icon la-icon"}):null)),e.createElement("div",{className:"footerItem-info-operate"},e.createElement("div",{className:"operate-div"},o.userSelectedNum>0?e.createElement("div",{onClick:this.reduceItem.bind(this,o,r),className:"reduce-btn-div"},e.createElement("span",{className:"reduce-btn btn ilBk-middle"})):null,o.userSelectedNum>0?e.createElement("div",null,e.createElement("span",{className:"select-num ilBk-middle"},o.userSelectedNum)):null,e.createElement("div",{className:"add-btn-div",onClick:this.addItem.bind(this,o,r)},e.createElement("span",{className:"add-btn btn ilBk-middle"}))),e.createElement("div",{className:"footerItem-info"},e.createElement("div",null,e.createElement("span",{className:"no-picture-sale-num ilBk-middle"},o.sales)),e.createElement("div",null,e.createElement("span",{className:"no-pocture-sale-price ilBk-middle"},e.createElement("span",null,"￥",o.curr_price),e.createElement("span",null)))))))):i.push(o)}if(0!=i.length)for(var r=0,n=i.length;r<n;r++){var o=i[r];t.push(e.createElement("li",{className:"smallImg-footItem forsearch",id:o.id,key:o.id},e.createElement("div",null),e.createElement("div",{className:"info"},e.createElement("div",{className:"no-picture-footItem-name"},e.createElement("span",null,o.name,1==o.has_discount?e.createElement("i",{className:"item-icon tejia-icon"}):null,1==o.showcase?e.createElement("i",{className:"item-icon zhaopai-icon"}):null,1==o.hotlevel?e.createElement("i",{className:"item-icon la-icon"}):null)),e.createElement("div",{className:"footerItem-info-operate"},e.createElement("div",{className:"operate-div"}),e.createElement("div",{className:"footerItem-info"},e.createElement("div",null,e.createElement("span",{className:"no-picture-sale-num ilBk-middle"},o.sales)),e.createElement("div",null,e.createElement("span",{className:"no-pocture-sale-price ilBk-middle"},e.createElement("span",null,"￥",o.curr_price),e.createElement("span",null)))))),e.createElement("div",{className:"outOfStock"})))}}return e.createElement("ul",{className:"menu-ul"},t)}}),te=e.createClass({displayName:"MenusDiv",mixins:[t.connect(o,"listData")],componentDidMount:function(){var e=document.getElementById("menu-article"),t=this.state.listData.allData.map(function(e){return e.title}),a=this;a.nowIdx=this.state.listData.nowIdx,P.throttle("scroll","menusScroll",e);var i=e.querySelectorAll(".classify-title");e.addEventListener("menusScroll",function(e){e.stopPropagation();var s=document.getElementById("groupTitle"+a.state.listData.nowIdx);s.classList.remove("startGPU");var r=this.scrollTop,n=void 0,o=a.state.listData.nowIdx;if(i[o+1]&&r>=i[o+1].offsetTop?n=o+1:i[o]&&r<i[o].offsetTop&&(n=o-1),void 0!=n){var l=t[n];l!=a.state.listData.allData[o].title&&(N.scrollSwitchClassification(n),a.state.listData.nowIdx=n>=0?n:0,document.querySelector(".now-classify-title").innerHTML=a.state.listData.allData[n].title)}},!0),setTimeout(function(){var e=document.getElementById("menu-article"),t=document.querySelector(".classify-content:last-child"),a=e.offsetHeight-t.offsetHeight;e.style.paddingBottom=a+"px"},300)},scrollToClassify:function(e){document.getElementById("menu-article");this.nowIdx=e-1>=0?e-1:e;var t=document.getElementById("groupTitle"+e);t.scrollIntoView(!0)},render:function(){var t,a=this,i=this.state.listData.allData.map(function(i,s){return s==a.state.listData.nowIdx&&(t=i.title),e.createElement("div",{className:"classify-content",id:"groupTitle"+s,"data-idx":s},e.createElement("span",{className:"classify-title"},i.title),e.createElement(ee,{classifyId:s,menuData:i.data}))});return e.createElement("div",{id:"foodsMenu-div"},e.createElement("div",{className:"now-classify-title"},t),e.createElement("article",{id:"menu-article"},i))}}),ae=e.createClass({displayName:"NavUl",mixins:[t.connect(C,"navList")],switchNav:function(e){N.switchClassification(e)},render:function(){var t=[];if(this.state.navList){t=[e.createElement("li",{onClick:n.openSearchModel},e.createElement("i",{className:"search-btn-icon"}))];for(var a=0,i=this.state.navList.length;a<i;a++){var s=this.state.navList[a];s.display&&(s.status?t.push(e.createElement("li",{className:"current-classify",id:s.id},0==a?e.createElement("i",{className:"hot-menus-icon ilBk-middle"}):null,e.createElement("span",{className:"ilBk-middle"},s.itemname),s.userSelectedClassifyNum&&s.userSelectedClassifyNum>0?e.createElement("b",{className:"classify-num-i"},s.userSelectedClassifyNum):null)):t.push(e.createElement("li",{onClick:this.switchNav.bind(this,a),id:s.id},e.createElement("span",{className:"ilBk-middle"},s.itemname),s.userSelectedClassifyNum&&s.userSelectedClassifyNum>0?e.createElement("b",{className:"classify-num-i"},s.userSelectedClassifyNum):null)))}}return e.createElement("ul",{id:"nav-ul"},t)}}),ie=(e.createClass({displayName:"AgaintOrder",againtOrder:function(){M.againtOrder()},render:function(){var t=this.props.obj[0].itemname;return e.createElement("div",{className:"againtOrder"},e.createElement("div",{className:"againtOrder--title"},"上次点过:"),e.createElement("div",{className:"againtOrder--info"},e.createElement("div",{className:"againtOrder--menuName"},{firstName:t}),e.createElement("div",{className:"againtOrder--btn",onClick:this.againtOrder},"再来一单")))}}),e.createClass({displayName:"MenuSection",render:function(){return this.props.advInfo.adside?e.createElement("section",{id:"menu-section"},e.createElement("div",{id:"nav-div"},e.createElement(ae,null)),e.createElement(te,null)):e.createElement("section",{id:"menu-section-top"},e.createElement("div",{id:"nav-div"},e.createElement(ae,null)),e.createElement(te,null))}})),se=e.createClass({displayName:"WithdrawalResult",render:function(){var t=this.props.result.success,a=this.props.price;return e.createElement("div",{className:"withdrawalResult"},t?e.createElement("img",{src:"./dist/imgs/orderOnline-ico_right.png",className:"withdrawalResult-img"}):e.createElement("img",{src:"./dist/imgs/orderOnline-ico_error.png",className:"withdrawalResult-img"}),t?e.createElement("h2",{className:"withdrawalResult-remind"},"饭卡余额提现成功!"):e.createElement("h2",{className:"withdrawalResult-remind_fail"},"饭卡余额提现失败!"),t?e.createElement("h3",{className:"withdrawalResult-info"},{price:a},"元将于10个工作日内退还到您的微信钱包!"):e.createElement("h3",{className:"withdrawalResult-info"},"由于网络故障，请退出重新扫描桌上二维码!"),e.createElement("div",{className:"withdrawalResult-button",onClick:this.props.closeModle}),e.createElement("i",{className:"mealCard-close",onClick:this.props.closeModle}))}}),re=e.createClass({displayName:"Withdrawal",withdrawal:function(){w.withdrawal()},render:function(){var t=this.props.info.fk_balance;return e.createElement("div",{className:"withdrawal"},e.createElement("h2",{className:"withdrawal-remind"},"平台饭卡已经关闭!"),e.createElement("h3",{className:"withdrawal-info"},"您的余额为：",e.createElement("span",{className:"price"},{price:t})),e.createElement("img",{src:"./dist/imgs/orderOnline-ico_money.png",className:"withdrawal-img"}),e.createElement("div",{className:"withdrawal-button",onClick:this.withdrawal}),e.createElement("i",{className:"mealCard-close",onClick:this.props.closeModle}))}}),ne=e.createClass({displayName:"MealCardModle",mixins:[t.connect(b,"mealCardObj")],closeModle:function(){w.closeWithdrawal()},render:function(){return this.state.mealCardObj.status?e.createElement("div",{className:"mealCardModle"},this.state.mealCardObj.resultStatus?null:e.createElement(re,{closeModle:this.closeModle,info:this.state.mealCardObj.mealCard}),this.state.mealCardObj.resultStatus?e.createElement(se,{closeModle:this.closeModle,price:this.state.mealCardObj.mealCard.fk_balance,result:this.state.mealCardObj.withdrawResult}):null):null}}),oe=e.createClass({displayName:"CouponModel",mixins:[t.connect(g,"couponObj")],closeModle:function(){k.close()},render:function(){var t=[0,"周一","周二","周三","周四","周五","周六","周日"],a=["周一,周二,周三,周四,周五","周六,周日"],i=[],s=this.state.couponObj.couponList,r=1;return i=s.map(function(i){var s="",n=[],o="";if(r=r>4?1:r,o="coupon_"+r,++r,i.week_days){for(var l=i.week_days.split(","),c=0,d=l.length;c<d;c++)n.push(t[l[c]]);s=n.join(",");var u=a.indexOf(s);s=u!=-1&&0==u?"使用时间：周一至周五":u!=-1&&1==u?"使用时间：周末":"使用时间："+s}return e.createElement("div",{className:"modal-body"},e.createElement("div",{className:"coupon-img-div"},"1"==i.coupontype?e.createElement("div",{className:"coupon_platform"},e.createElement("img",{src:"./dist/imgs/food-default-image.png"})):e.createElement("div",{className:o},e.createElement("div",null,"￥",e.createElement("span",{className:"coupon_price"},i.par_value))),e.createElement("div",{className:"coupon-info"},e.createElement("div",{className:"table-div"},e.createElement("div",null,e.createElement("ul",null,i.order_min_price>0?e.createElement("li",{className:"coupon-rule-content"},"1"==i.coupontype?e.createElement("span",null,i.par_value,"元券",e.createElement("span",{className:"corl99"}," (限",i.product_name,"使用)")):e.createElement("span",null,"满",i.order_min_price,"元可用","2"==i.coupontype?e.createElement("span",{className:"corl99"}," (全平台通用券)"):null)):e.createElement("li",{className:"coupon-rule-content"},"无使用限制"),e.createElement("li",{className:"coupon-rule-other"},s," ",i.time_slots?i.time_slots+"可使用":""),e.createElement("li",{className:"coupon-rule-other"},"有效日期至：",i.invalid_date.substr(0,10))))))))}),this.state.couponObj.status?e.createElement("div",{className:"modal-coupon",id:"modal-coupon"},e.createElement("div",{className:"coupon-content-div"},e.createElement("h1",{className:"coupon-content__title"},"您还有",i.length,"张优惠券未使用"),e.createElement("div",{className:"coupon-display-area"},i),e.createElement("div",{className:"coupon-btn",onClick:this.closeModle},"立即使用"))):null}}),le=e.createClass({displayName:"Aside",render:function(){return e.createElement("aside",{id:"aside",className:"marquee bd-b1-nav"},e.createElement("i",{className:"marquee-icon"}),e.createElement("marquee",{scrollamount:"5",className:"startGPU"},e.createElement("span",{className:"marquee-span",id:"discname"},this.props.advInfo.adside)))}}),ce=e.createClass({displayName:"AdvImg",open:function(e){e.preventDefault(),M.open()},render:function(){return e.createElement("div",{id:"dc-id",onClick:this.open},e.createElement("div",{className:"dc-box"},e.createElement("div",{className:"dc-btn"},"X"),e.createElement("img",{className:"dc-img",src:this.props.advInfo.img,id:"advImg",alt:""})))}}),de=e.createClass({displayName:"OrderFoodOnline",mixins:[t.connect(InitStore,"initInfo")],render:function(){return e.createElement("div",null,this.state.initInfo.imgState?e.createElement(ce,{advInfo:this.state.initInfo}):null,this.state.initInfo.adside?e.createElement(le,{advInfo:this.state.initInfo}):null,e.createElement(oe,null),e.createElement(ie,{advInfo:this.state.initInfo}),e.createElement(Z,null),e.createElement(K,null),e.createElement(Y,null),e.createElement(X,null),e.createElement(G,null),e.createElement(L,null),e.createElement(j,null),e.createElement(O,null),e.createElement(f,null),e.createElement(S,null),e.createElement(ne,null),this.state.initInfo.multiplayer?e.createElement(T,null):null,e.createElement(E,null))}});e.render(e.createElement(de,null),document.getElementById("orderFoodId"),function(){sessionStorage.OFO=location.pathname.split("/")[3],document.body.removeChild(document.getElementById("loading")),P.recordAction.add("036","000")})}(window.React,window.Reflux,window.MenusActions,window.ShopCarModelActions,window.SuitModelActions,window.PropertyModelActions,window.SearchModelActions,window.MenuStore,window.ShopCarModelStore,window.SuitModelStore,window.PropertyModelStore,window.SearchModelStore,window.FloatSectionStore,window.FloatSectionActions,window.AlertActions,window.AlertModel,window.CouponStore,window.WaitModel,window.WaitActions,window.AdvImgStore,window.BigImgModelStore,window.BigImgModelActions,window.NavActions,window.NavStore,window.ConfirmModel,window.WebSocketStore,window.InitActions,window.MealCardActions,window.MealCardStore,window.CouponActions,window);